import{j as t,r as u,c as le}from"./react-DLwQdj7q.js";import{a as Re}from"./react-dom-Bpij0FWw.js";import{B as Ee}from"./react-router-dom-Bjp-w-kY.js";import{u as y,a as T,P as Me}from"./react-redux-BsdHwLJa.js";import{c as V,a as de,b as Pe}from"./@reduxjs-NaPybp_z.js";import{c as Te,u as ue,a as $e,T as E,B as M,b as Be,F as ze,N as _e,d as L,S as D,H as Oe,D as Le,A as We,e as Ae,C as He,R as De,E as Ge,s as pe,f as xe,g as Ze,h as Ke,i as Ue,j as Ve,k as Je}from"./@mui-gEQS-3Z-.js";import{d as me}from"./lodash-D9Xc9Uuo.js";import{c as Q,A as Xe}from"./react-select-Cfw0BZ38.js";import{P as g}from"./prop-types-D7IYfoA1.js";import{s as J}from"./string-width-BwHzav8R.js";import"./@babel-3BxVu_ax.js";import"./scheduler-SPyfQU6S.js";import"./react-router-CV6FO8-_.js";import"./@remix-run-BBWqMfS0.js";import"./use-sync-external-store-BCKmAaC2.js";import"./redux-BXkGT1VS.js";import"./immer-DqxjFn0G.js";import"./redux-thunk-ClJT1hhx.js";import"./@emotion-_JA2SG62.js";import"./hoist-non-react-statics-C-Qo8PK8.js";import"./stylis-DDa9OTMq.js";import"./clsx-B-dksMZM.js";import"./react-transition-group-CndzbEAZ.js";import"./@popperjs-CMBiYTiD.js";import"./react-is-BPJnJB5S.js";import"./@floating-ui-Dqirgmo9.js";import"./use-isomorphic-layout-effect-8A7Cpl8G.js";import"./memoize-one-BdPwpGay.js";import"./get-east-asian-width-R4ibU9pT.js";import"./emoji-regex-D90yNSKR.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();const Ye=/\([A-Z]{2}\d{3}\)$/,ee=e=>e.replace(Ye,"").trim(),Qe=e=>{const r=e.data.name_en,n=e.data.name_tc;return{en:ee(r),zh:ee(n)}},et=(e,r="number")=>{var s;return e&&(((s={number:{O:"1",I:"2"},letter:{1:"O",2:"I"}}[r])==null?void 0:s[e])||e)},tt=e=>e&&String(parseInt(e,10)),P="｜",X="往",he="特別班",rt="Desc_CHI",G=new Map;async function nt(){const e=await fetch("https://data.etabus.gov.hk/v1/transport/kmb/route/");if(!e.ok)throw new Error(`HTTP error! status: ${e.status} ${e.statusText}`);return(await e.json()).data}async function ot(e,r,n){return(await(await fetch(`https://data.etabus.gov.hk/v1/transport/kmb/route-stop/${e}/${r}/${n}`)).json()).data.map(o=>o.stop)}async function st(e){if(G.has(e))return G.get(e);try{const r=await fetch(`https://data.etabus.gov.hk/v1/transport/kmb/stop/${e}`);if(!r.ok)throw new Error(`HTTP error! status: ${r.status} ${r.statusText}`);const n=await r.json(),s=Qe(n);return G.set(e,s),s}catch(r){throw console.error(`Error when fetching stop detail for stopID: ${e}`,r),r}}async function at(e){return Promise.all(e.map(st))}async function it(e,r,n){var i,d;const s=et(r,"number"),a=await fetch(`https://search.kmb.hk/KMBWebSite/Function/FunctionRequest.ashx?action=getSpecialRoute&route=${e}&bound=${s}`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status} ${a.statusText}`);const c=(d=(i=(await a.json()).data)==null?void 0:i.routes)==null?void 0:d.find(({Route:p,Bound:x,ServiceType:m})=>e===p&&s===x&&n===tt(m==null?void 0:m.trim()));return(c==null?void 0:c[rt])??""}const ct={routes:[],isLoading:!1,error:null},lt=()=>async e=>{e(te(!0));try{const r=await nt(),n=new Map(r.map(o=>[`${o.route}-${o.bound}-${o.service_type}`,o])),s=r.filter(o=>o.service_type!=="1").map(async o=>{const c=await it(o.route,o.bound,o.service_type),i=`${o.route}-${o.bound}-${o.service_type}`;n.set(i,{...o,specialRemark:c})});await Promise.all(s);const a=Array.from(n.values());localStorage.setItem("routes",JSON.stringify(a)),e(ge(a))}catch(r){console.error("Error fetching routes:",r),e(ut(r.message))}finally{e(te(!1))}},dt=()=>async e=>{const r=localStorage.getItem("routes");if(r){e(ge(JSON.parse(r)));return}e(lt())},fe=V({name:"route",initialState:ct,reducers:{setRoutes:(e,r)=>{e.routes=r.payload},setLoading:(e,r)=>{e.isLoading=r.payload},setError:(e,r)=>{e.error=r.payload}}}),{setRoutes:ge,setLoading:te,setError:ut}=fe.actions,pt=fe.reducer,xt={routeDetail:{},currentStopIndex:0,lastStopIndex:0,isUserSelectedRoute:!1,routeHasTwoBound:!1,isLoading:!1,loadingError:null},mt=e=>e.routeSelection.currentStopIndex>0,ht=e=>e.routeSelection.currentStopIndex<e.routeSelection.lastStopIndex,Y=de("routeSelection/selectRoute",async({routeDetail:e,routes:r},{dispatch:n})=>{n(re(!0)),n(ne(null));try{const{route:s,bound:a,service_type:o,orig_tc:c,orig_en:i,dest_tc:d,dest_en:p,specialRemark:x}=e,m=r.some(l=>l.bound==="I"&&l.route===s)&&r.some(l=>l.bound==="O"&&l.route===s);n(bt(m));const w=a==="I"||a==="inbound"?"inbound":"outbound",h=await ot(s,w,o),b=await at(h);n(U(0)),n(ft({route:s,bound:w,stops:b,orig_tc:c,orig_en:i,dest_tc:d,dest_en:p,service_type:o,specialRemark:x})),n(wt(!0))}catch(s){n(ne(s.message))}finally{n(re(!1))}}),we=de("routeSelection/changeBound",async(e,{getState:r,dispatch:n})=>{const s=r().routeSelection,a=r().route.routes,{routeDetail:o,routeHasTwoBound:c,isUserSelectedRoute:i}=s;if(i&&(c||(o==null?void 0:o.service_type)===1)){const{bound:d}=o;n(Y({routeDetail:{...o,bound:d==="inbound"?"outbound":"inbound"},routes:a}))}}),be=V({name:"routeSelection",initialState:xt,reducers:{setRouteDetail(e,r){var n;e.routeDetail=r.payload,e.lastStopIndex=(((n=r.payload.stops)==null?void 0:n.length)??1)-1},setCurrentStopIndex(e,r){e.currentStopIndex=r.payload},toPrevStop(e){e.currentStopIndex>0&&(e.currentStopIndex-=1)},toNextStop(e){e.currentStopIndex<e.lastStopIndex&&(e.currentStopIndex+=1)},resetToFirstStop(e){e.currentStopIndex=0},setIsUserSelectedRoute(e,r){e.isUserSelectedRoute=r.payload},setRouteHasTwoBound(e,r){e.routeHasTwoBound=r.payload},setIsLoading:(e,r)=>{e.isLoading=r.payload},setLoadingError:(e,r)=>{e.loadingError=r.payload}}}),{setRouteDetail:ft,setCurrentStopIndex:U,toPrevStop:je,toNextStop:ye,resetToFirstStop:gt,setIsUserSelectedRoute:wt,setRouteHasTwoBound:bt,setIsLoading:re,setLoadingError:ne}=be.actions,jt=be.reducer,yt={stopPressed:!1,driverInfo:{nameZh:"九巴仔",nameEn:"KMB Boy",staffNo:"1933"},customizeDriverInfoToggle:!1,showMindDoorNotice:!1,showHandrailNotice:!1},Se=V({name:"userPreference",initialState:yt,reducers:{setStopPressed(e,r){e.stopPressed=r.payload},setDriverInfo(e,r){e.driverInfo={...e.driverInfo,...r.payload}},setCustomizeDriverInfoToggle(e,r){e.customizeDriverInfoToggle=r.payload},setShowMindDoorNotice(e,r){e.showMindDoorNotice=r.payload},setShowHandrailNotice(e,r){e.showHandrailNotice=r.payload},setShowHandrailAndMindDoorNotice(e,r){e.showHandrailNotice=r.payload.showHandrailNotice,e.showMindDoorNotice=r.payload.showMindDoorNotice}}}),{setStopPressed:St,setDriverInfo:Z,setCustomizeDriverInfoToggle:vt,setShowMindDoorNotice:Or,setShowHandrailNotice:Lr,setShowHandrailAndMindDoorNotice:oe}=Se.actions,Nt=Se.reducer,kt=Pe({reducer:{route:pt,routeSelection:jt,userPreference:Nt}}),Ct=Te({breakpoints:{values:{xs:480,sm:640,md:768,lg:1024,xl:1280,"2xl":1536,"3xl":1920}},typography:{fontFamily:"Noto Sans, sans-serif"},palette:{darkRed:{main:"#A81919",light:"#EF4444",dark:"#991212",contrastText:"#FFF1F2"},nextGreen:{main:"#089314",light:"#147738",dark:"#077F11",contrastText:"#FFFFFF"},directionPurple:{main:"#822093",light:"#B983D6",dark:"#701C7F",contrastText:"#F3E8FF"},ochre:{main:"#E3D026",light:"#FFF176",dark:"#C4B121",contrastText:"#262A33"},snowwhite:{main:"#FFFFFF"}}}),$={groupWrapper:"flex flex-wrap gap-5 max-md:gap-3 justify-center",switchGroupWrapper:"!gap-4",driverInfoSection:"flex text-center items-center text-white gap-3"},It=({mainScreenTarget:e,secScreenTarget:r})=>{const n=y(s=>s.userPreference);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:$.groupWrapper,children:t.jsx(Lt,{})}),t.jsx("div",{className:$.groupWrapper+" "+$.switchGroupWrapper,children:t.jsx(Ot,{})}),t.jsx("div",{className:$.groupWrapper,children:t.jsx(_t,{mainScreenTarget:e,secScreenTarget:r})}),n.customizeDriverInfoToggle&&t.jsx("section",{className:$.driverInfoSection,children:t.jsx(Ft,{})})]})},Ft=()=>{const{driverInfo:e}=y(n=>n.userPreference),r=T();return t.jsxs(t.Fragment,{children:[t.jsx(W,{placeholder:"車長中文姓氏 (最多2字)",maxLength:2,value:e==null?void 0:e.nameZh,defaultValue:e==null?void 0:e.nameZh,onChange:n=>{n==""&&(n="九巴仔"),r(Z({nameZh:n}))}}),t.jsx(W,{style:"capitalize",placeholder:"車長英文姓氏 (最多10字)",maxLength:10,value:e==null?void 0:e.nameEn,defaultValue:e==null?void 0:e.nameEn,onChange:n=>{n==""&&(n="KMB Boy"),r(Z({nameEn:n}))}}),t.jsx(W,{placeholder:"職員編號 (1位至6位數字)",type:"number",minLength:1,maxLength:6,value:e==null?void 0:e.staffNo,defaultValue:e==null?void 0:e.staffNo,onInput:n=>n.target.value=Math.abs(n.target.value.slice(0,6)),onChange:n=>{n==""&&(n="1933"),r(Z({staffNo:n}))}})]})},qt=({onPrev:e,onNext:r,onHome:n,onEnd:s,isUserSelectedRoute:a=!0,debounceMs:o=50,isDisabled:c=!1})=>{const i=u.useRef(null),d=u.useCallback(p=>{if(!(i.current||c)){switch(p){case"ArrowLeft":e==null||e();break;case"ArrowRight":r==null||r();break;case"Home":n==null||n();break;case"End":s==null||s();break;default:return}i.current=setTimeout(()=>{i.current=null},o)}},[e,r,n,s,o,c]);u.useEffect(()=>{if(!a)return;const p=x=>d(x.key);return window.addEventListener("keydown",p),()=>{window.removeEventListener("keydown",p),i.current&&(clearTimeout(i.current),i.current=null)}},[d,a])},Rt=(e,r,n,s)=>u.useMemo(()=>e<=n?[0,e]:r<s?[0,n]:r>=e-n?[e-n,e]:[r-s+1,r-s+1+n],[e,r,n,s]),Et=()=>{const[e,r]=u.useState(!1),[n,s]=u.useState(null);return u.useEffect(()=>{const c=localStorage.getItem("userSelection");if(c)try{const i=JSON.parse(c);s(i),r(!0)}catch(i){console.error("Error parsing stored data:",i),localStorage.removeItem("userSelection")}},[]),{hasStoredData:e,storedData:n,saveToLocalStorage:c=>{try{localStorage.setItem("userSelection",JSON.stringify(c))}catch(i){console.error("Error saving to localStorage:",i)}},clearStoredData:()=>{localStorage.removeItem("userSelection"),r(!1),s(null)}}},Mt={regular:{},xhtEhc:{backgroundColor:"#CF0001"},marathon:{backgroundColor:"#CF0001"},whc:{backgroundColor:"#027233"},airport:{backgroundColor:"#0A2163",color:"#E3D026"},external:{backgroundColor:"#ff5000"},overnight:{backgroundColor:"#000000"},airportOvernight:{backgroundColor:"#000000",color:"#DED702"},premier:{backgroundColor:"#E5B034"},shuttle:{backgroundColor:"#EB5136",color:"#0E2775"},disneyRecreational:{backgroundColor:"#146FD1"},r8:{backgroundColor:"#72C8E5",color:"#1C2EB5"},awe:{backgroundColor:"#6F2F9F"}},Pt=[{type:"regular",regex:/^(331)[S]?/},{type:"xhtEhc",regex:/^[136]\d{2}[A-Z]?$/},{type:"whc",regex:/^9(?!17|18|45$)\d{2}[A-Z]?$/},{type:"overnight",regex:/^(N(?!A)[A-Z0-9]+|270S|271S|293S)$/i},{type:"airport",regex:/^A/},{type:"airportOvernight",regex:/^NA/},{type:"external",regex:/^E/},{type:"shuttle",regex:/^S(?!P)/},{type:"premier",regex:/^P96[08]$/},{type:"disneyRecreational",regex:/^R(33|42)$/i},{type:"r8",regex:/^R8$/i},{type:"marathon",regex:/^R(108|603|673|678|680|934|936|948|960|961|968)$/i},{type:"awe",regex:/^X(33|36|40|43|47)$/i}],Tt=()=>{const{isMobile:e}=R(),r=u.useMemo(()=>e?"mobile":"desktop",[e]),n=u.useMemo(()=>({display:"inline-block",textAlign:"center",color:"#FFFFFF",width:e?"42px":"52px",borderRadius:"2px",fontWeight:700}),[e]),s=u.useMemo(()=>({...Mt,shared:n}),[n]),a=u.useMemo(()=>new Map,[]);return u.useMemo(()=>c=>{const i=`${c}-${r}`;if(a.has(i))return a.get(i);const d=Pt.find(x=>x.regex.test(c)),p={...s.shared,...s[(d==null?void 0:d.type)??"regular"]};return a.set(c,p),p},[s,a,r])},R=()=>{const[e,r]=u.useState({width:window.innerWidth,height:window.innerHeight,isMobile:window.innerWidth<=768}),n=u.useMemo(()=>me(()=>{r({width:window.innerWidth,height:window.innerHeight,isMobile:window.innerWidth<=768})},150),[]);return u.useEffect(()=>(window.addEventListener("resize",n),()=>{n.cancel(),window.removeEventListener("resize",n)}),[n]),e},se=(e,r,n,s=[])=>{u.useEffect(()=>{e.current&&r.current&&(e.current.style.display="block",r.current.style.display="none");const o=setInterval(()=>{if(e.current&&r.current){const c=e.current.style.display!=="none";e.current.style.display=c?"none":"block",r.current.style.display=c?"block":"none"}},n);return()=>clearInterval(o)},s)},ve={labelWrapper:{display:"flex",gap:"1.5px",alignItems:"center",fontSize:window.innerWidth<=768?"14px":"18px",fontWeight:500,minWidth:0},reactSelect:{control:(e,r)=>({...e,backgroundColor:"rgba(24, 27, 27, 0.5)",color:"#fff",borderColor:r.isFocused?"#2563eb":"#444",boxShadow:r.isFocused?"0 0 0 2px #2563eb":e.boxShadow,height:window.innerWidth<=768?36:42,minHeight:window.innerWidth<=768?36:42}),menu:e=>({...e,backgroundColor:"rgba(35, 39, 47, 0.85)",color:"#fff",zIndex:9999,fontSize:window.innerWidth<=768?"14px":e.fontSize}),placeholder:e=>({...e,color:"#777",opacity:1}),option:(e,r)=>({...e,backgroundColor:r.isFocused?"rgba(0, 0, 0, 1)":"rgba(32, 36, 38, 0.9)",color:"#fff"}),input:e=>({...e,color:"#fff"}),singleValue:e=>({...e,color:"#fff"}),indicatorSeparator:(e,r)=>({...e,backgroundColor:r.isFocused?"#2563eb":"#444"}),dropdownIndicator:(e,r)=>({...e,color:r.isFocused?"#00194f":"#444","&:hover":{color:"#999"}}),clearIndicator:(e,r)=>({...e,color:r.isFocused?"#2563eb":"#444","&:hover":{color:"#999"}})}},ae=e=>({label:`${e.route}${P} ${e.orig_tc} ${X} ${e.dest_tc} ${P}${e.service_type!=1?he:""}${P}${e.specialRemark??""}`,value:`${e.route}-${e.bound}-${e.service_type}`,detail:e}),Ne=({componentType:e,data:r,...n})=>{const{isMobile:s}=R(),{label:a}=r,[o,c,i,d=""]=a.split(P),[p,x]=c.split(X),m=e==="Option"?Q.Option:Q.SingleValue,w=u.useMemo(()=>({...ve.labelWrapper,fontSize:s?"14px":"18px",gap:s?"2px":"4px"}),[s]);return t.jsx(m,{...n,data:r,children:t.jsxs("div",{style:w,children:[t.jsx(Bt,{route:o,isSpecial:i==null?void 0:i.includes(he),componentType:e,isMobile:s}),t.jsx(zt,{origin:p,destination:x,remark:d})]})})},ke=le.memo(e=>t.jsx(Ne,{...e,componentType:"Option"}));ke.displayName="MemoizedOption";const Ce=le.memo(e=>t.jsx(Ne,{...e,componentType:"SingleValue"}));Ce.displayName="MemoizedSingleValue";const $t=()=>{const{isMobile:e}=R(),r=T(),{routes:n}=y(l=>l.route),[s,a]=u.useState(null),[o,c]=u.useState([]),i=u.useMemo(()=>{var l;return(l=n==null?void 0:n.slice(0,50))==null?void 0:l.map(ae)},[n]),d=u.useRef(new Map),[p,x]=u.useState(!1),m=u.useMemo(()=>me((l,j)=>{const I=(l==null?void 0:l.toUpperCase())||"";if(d.current.has(I)){const v=d.current.get(I);c(v),j(v),x(!1);return}setTimeout(()=>{try{const v=l?n.filter(N=>N.route.toUpperCase().startsWith(I)):n.slice(0,50);((N=0)=>{const H=v.slice(N,N+50).map(ae);N===0&&(d.current.set(I,H),c(H),j(H),x(!1))})(0)}catch(v){console.error("Search error:",v),x(!1)}},0)},150),[n]);u.useEffect(()=>()=>{m.cancel(),d.current.clear()},[m]);const w=u.useCallback((l,j)=>{x(!0),m(l,j)},[m]),h=u.useCallback(l=>{l&&(r(Y({routeDetail:l.detail,routes:n})),a(l))},[r,n]),b=u.useMemo(()=>({...ve.reactSelect,control:(l,j)=>({...l,backgroundColor:"rgba(24, 27, 27, 0.5)",color:"#fff",borderColor:j.isFocused?"#2563eb":"#444",boxShadow:j.isFocused?"0 0 0 2px #2563eb":l.boxShadow,height:e?36:42,minHeight:e?36:42}),menu:l=>({...l,backgroundColor:"rgba(35, 39, 47, 0.85)",color:"#fff",zIndex:9999,fontSize:e?"14px":l.fontSize})}),[e]);return t.jsx(Xe,{components:{Option:ke,SingleValue:Ce},classNamePrefix:"routeInputSelect",menuPortalTarget:document.body,styles:b,autoFocus:!0,isClearable:!0,cacheOptions:!0,defaultOptions:o.length?o:i,placeholder:"輸入九巴路線編號　Input KMB route.",loadingMessage:()=>"搜尋路線中...",isLoading:p,filterOption:null,loadOptions:w,value:s,onChange:h})},Bt=({route:e,isSpecial:r,componentType:n})=>{const{isMobile:s}=R(),a=Tt(),o=u.useMemo(()=>({routeLabel:{display:n==="Option"?"inline-flex":"flex",flexDirection:n==="Option"?"column":"row",gap:n==="Option"?0:"4px",width:n==="Option"?s?"36px":"52px":"fit-content",alignItems:"center",justifyContent:"center",letterSpacing:"-0.25px",minWidth:s?"40px":"52px",position:"relative",transform:"scale(1, 1.1)"},specialTrip:{marginTop:"2px",fontSize:s?"10px":"12px",padding:s?"1px 4px":"2px 6px",border:"1px solid rgba(8, 28, 81, 1)",borderRadius:"4px",backgroundColor:"rgba(255, 214, 0, 0.75)",color:"#000",lineHeight:1.1,maxWidth:"100%",textAlign:"center"}}),[s,n]);return t.jsxs("div",{style:o.routeLabel,children:[t.jsx("span",{style:a(e),children:e}),r&&t.jsx("span",{style:o.specialTrip,children:"特別班"})]})},zt=({origin:e,destination:r,remark:n})=>{const{isMobile:s}=R(),a=u.useMemo(()=>({wrapper:{display:"inline-flex",letterSpacing:s?"0":"0.25px",alignItems:"center",gap:s?"4px":"8px",minWidth:0,flexWrap:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},special:{fontSize:s?"12px":"15px",textAlign:"center",maxWidth:s?"120px":"none",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},to:{fontSize:s?"10px":"14px",marginTop:"1.5px",fontWeight:400}}),[s]);return t.jsxs(t.Fragment,{children:[t.jsx("span",{children:P}),t.jsxs("div",{style:a.wrapper,children:[e,t.jsx("span",{style:a.to,children:X}),r]}),t.jsx("span",{children:P}),n&&t.jsx("span",{style:a.special,children:n})]})},q=e=>{const r=ue(),{isMobile:n}=R();return u.useMemo(()=>{var s;return{button:{margin:0,backgroundColor:a=>{var o;return((o=a.palette[e])==null?void 0:o.main)||a.palette.primary.main},color:a=>{var o;return(o=a.palette[e])==null?void 0:o.contrastText},borderRadius:2,boxShadow:"0 2px 8px 0 rgba(0,0,0,0.10)",fontFamily:"Zen Kaku Gothic Antique",fontWeight:500,fontSize:n?"1.1rem":"1rem",height:n?"64px":"48px",px:2,py:1,textTransform:"none",transition:"all 0.2s ease-in-out",outline:"none","&:hover":{backgroundColor:a=>{var o;return((o=a.palette[e])==null?void 0:o.dark)||a.palette.primary.dark},boxShadow:"0 6px 24px 0 rgba(37,99,235,0.18)",filter:"brightness(1.08)",transform:"translateY(-2px) scale(1.04)",outline:`2.5px solid ${(s=r.palette[e])==null?void 0:s.dark}`,outlineOffset:"1px"},"&:focus-visible":{outline:"2.5px solid #2563eb",outlineOffset:"1px"},"&:active":{boxShadow:"0 1px 4px 0 rgba(0,0,0,0.12)",filter:"brightness(0.97)",transform:"scale(0.98)"},"&.Mui-disabled":{backgroundColor:"#2d2b2b !important",color:"#595555 !important",boxShadow:"none",opacity:1,border:"1px solid #2d2b2b",cursor:"not-allowed"}},label:{fontSize:n?"1.25rem":"1rem",whiteSpace:"nowrap",fontFamily:"Zen Kaku Gothic Antique",fontWeight:500},labelWrapper:{display:"flex",alignItems:"center",gap:6},switch:{"& .MuiSwitch-switchBase.Mui-checked":{color:a=>{var o;return((o=a.palette[e])==null?void 0:o.light)||a.palette.primary.light},"&:hover":{backgroundColor:a=>{var o;return $e(((o=a.palette[e])==null?void 0:o.light)||a.palette.primary.light,.08)}}},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:a=>{var o;return((o=a.palette[e])==null?void 0:o.dark)||a.palette.primary.dark},opacity:.75},transform:n?"scale(1.5)":"scale(1.1)"},switchLabel:{display:"flex",alignItems:"center",gap:n?2:1}}},[e,n,r])},_t=({mainScreenTarget:e,secScreenTarget:r})=>{const{isUserSelectedRoute:n}=y(i=>i.routeSelection),{customizeDriverInfoToggle:s}=y(i=>i.userPreference),a=T(),o=q("info"),c=[{key:"main",target:e,label:"主螢幕全螢幕"},{key:"sec",target:r,label:"輔螢幕全螢幕"}];return t.jsxs(t.Fragment,{children:[t.jsx(E,{arrow:!0,placement:"bottom-start",title:"自定義車長資料顯示",children:t.jsx("span",{children:t.jsx(M,{sx:o.button,color:"ochre",variant:"contained",startIcon:t.jsx(Be,{}),onClick:()=>{a(vt(!s))},children:t.jsx("span",{className:o.label,children:"更改車長資料"})})})}),c.map(({key:i,target:d,label:p})=>t.jsx(E,{className:o.fullscreenTooltip,arrow:!0,placement:"bottom-start",title:"選擇路線後才能開啟全螢幕顯示功能",children:t.jsx("span",{children:t.jsx(M,{sx:{...o.button,display:{xs:"none",md:"inline-block"}},color:"info",variant:"contained",disabled:!n,className:o.button,startIcon:t.jsx(ze,{}),onClick:()=>{d.current.requestFullscreen()},children:t.jsx("span",{children:p})})})},i))]})},Ot=()=>{const{stopPressed:e,showHandrailNotice:r,showMindDoorNotice:n}=y(c=>c.userPreference),s=T(),a=q("darkRed"),o=q("ochre");return t.jsxs(t.Fragment,{children:[t.jsx(K,{sx:a.button,control:t.jsx(D,{checked:e,onChange:()=>s(St(!e)),name:"stop pressed",sx:a.switch}),label:t.jsxs("span",{style:a.labelWrapper,children:[t.jsx(_e,{color:"snowwhite"}),t.jsx(L,{variant:"button",sx:a.label,children:e?"  解除":" 按鐘"})]})}),t.jsx(K,{sx:o.button,control:t.jsx(D,{checked:r,color:"gold",onChange:()=>{s(oe({showHandrailNotice:!r,showMindDoorNotice:n&&!1}))},name:"handrail notice",sx:o.switch}),label:t.jsxs("span",{style:o.labelWrapper,children:[t.jsx(Oe,{}),t.jsx(L,{sx:o.label,variant:"button",children:"請緊握扶手"})]})}),t.jsx(K,{sx:o.button,control:t.jsx(D,{checked:n,color:"gold",onChange:()=>{s(oe({showMindDoorNotice:!n,showHandrailNotice:r&&!1}))},name:"mind door notice",sx:o.switch}),label:t.jsxs("span",{style:o.labelWrapper,children:[t.jsx(Le,{}),t.jsx(L,{sx:o.label,variant:"button",children:"車門正在關上"})]})})]})},Lt=()=>{const e=T(),{currentStopIndex:r,isUserSelectedRoute:n,routeDetail:s,routeHasTwoBound:a}=y(m=>m.routeSelection),o=y(mt),c=y(ht),i=q("nextGreen"),d=q("darkRed"),p=q("ochre"),x=q("directionPurple");return t.jsxs(t.Fragment,{children:[t.jsx(E,{arrow:!0,placement:"bottom-start",title:"上一站 鍵盤快捷鍵: '←'",children:t.jsx("span",{children:t.jsx(M,{color:"darkRed",variant:"contained",sx:d.button,startIcon:t.jsx(We,{}),onClick:()=>e(je()),disabled:!o,children:t.jsx("span",{className:d.buttonLabel,children:"上站"})})})}),t.jsx(E,{arrow:!0,placement:"bottom-start",title:"下一站 鍵盤快捷鍵: '→'",children:t.jsx("span",{children:t.jsx(M,{color:"nextGreen",variant:"contained",sx:i.button,startIcon:t.jsx(Ae,{}),onClick:()=>e(ye()),disabled:!c,children:t.jsx("span",{className:i.buttonLabel,children:"下站"})})})}),t.jsx(E,{arrow:!0,placement:"bottom-start",title:"切換路線方向 鍵盤快捷鍵: 'END'",children:t.jsx("span",{children:t.jsx(M,{color:"directionPurple",variant:"contained",sx:x.button,startIcon:t.jsx(He,{}),onClick:()=>e(we()),disabled:!n||!a||(s==null?void 0:s.service_type)!=1,children:t.jsx("span",{className:x.buttonLabel,children:"方向"})})})}),t.jsx(E,{arrow:!0,placement:"bottom-start",title:"重設至首站 鍵盤快捷鍵: 'HOME'",children:t.jsx("span",{children:t.jsx(M,{className:p.button,color:"ochre",variant:"contained",startIcon:t.jsx(De,{}),sx:p.button,onClick:()=>e(gt()),disabled:!n||r==0,children:t.jsx("span",{className:p.buttonLabel,children:"首站"})})})})]})},Wt=11e3,At=4500,z={parentGrid:["select-none","grid","grid-rows-[0.5fr_1.85fr_0.0375fr_1fr_0.125fr]"].join(" "),nextStopIndicatorGrid:["@container","col-start-1 col-end-2","flex flex-col items-center justify-center","text-center"].join(" "),nextStopIndicatorZh:["text-[15cqw]","mb-[-4px]","font-[600]","max-sm:text-[16cqw]","max-sm:mb-[-1px]"].join(" "),nextStopIndicatorEn:["text-[7.5cqw]","max-sm:text-[9cqw]","font-[400]"].join(" "),routeHeadingGrid:["@container","col-start-2 col-end-5","flex items-center gap-1","pl-0.5","bg-black text-white"].join(" "),stopProgressBarGrid:["@container","col-start-1 col-end-5","bg-white"].join(" "),stopProgressBarContainer:["h-full","font-[400]","text-center","tracking-tight"].join(" "),dividerGrid:["col-start-1 col-end-5","bg-black"].join(" "),stopNameGrid:["@container","col-start-1 col-end-5","bg-white","flex justify-center items-center"].join(" "),stopNameZh:["font-[500]","text-[8cqw]","max-sm:text-[8.5cqw]","max-md:text-[10cqw]","tracking-wider","whitespace-nowrap overflow-hidden"].join(" "),stopNameEn:["text-center","font-[500]","text-[5cqw]","max-sm:text-[4cqw]","max-md:text-[5cqw]"].join(" "),driverInfoGrid:["@container","flex justify-center","col-start-1 col-end-5","font-[400]","text-white","p-0.5"].join(" "),driverInfoText:["text-[2cqw]","max-md:text-[2.25cqw]"].join(" "),capitalize:"capitalize",noticeZhOverrideStyle:"!text-[8cqw]",noticeEnOverrideStyle:"!text-[3.75cqw]"},Ht=e=>{const r=J(e||"");return`clamp(2rem, ${Math.max(16-r*.45,6.5)}cqw, 10cqw)`},Dt=({monitorStyle:e,screenTarget:r})=>{var j,I,v,A,N;const{routeDetail:n,currentStopIndex:s,isLoading:a}=y(B=>B.routeSelection),{showHandrailNotice:o,showMindDoorNotice:c,stopPressed:i,driverInfo:d}=y(B=>B.userPreference),p=(I=(j=n==null?void 0:n.stops)==null?void 0:j[s])==null?void 0:I.zh,x=(A=(v=n==null?void 0:n.stops)==null?void 0:v[s])==null?void 0:A.en,m=u.useRef(null),w=u.useRef(null),h=u.useRef(null),b=u.useRef(null);se(m,w,Wt,[n==null?void 0:n.route,n==null?void 0:n.bound,n==null?void 0:n.service_type]),se(h,b,At,[n==null?void 0:n.route,n==null?void 0:n.bound,n==null?void 0:n.service_type]),u.useEffect(()=>{o||c?(h.current&&(h.current.style.display="none"),b.current&&(b.current.style.display="none")):(h.current&&(h.current.style.display="block"),b.current&&(b.current.style.display="none"))},[o,c]);const l={...z,parentGrid:`${z.parentGrid} ${e}`,nextStopIndicatorGrid:`${z.nextStopIndicatorGrid} ${i?"bg-[#FF0000] text-white":"bg-[#FFFF00] text-black"}`,driverInfoGrid:`${z.driverInfoGrid} ${i?"bg-[#FF0000]":"bg-black"}`};return t.jsxs("div",{ref:r,className:l.parentGrid,children:[t.jsxs("div",{className:l.nextStopIndicatorGrid,children:[t.jsxs("div",{className:l.nextStopIndicatorZh,children:["下一站",i&&"停於"]}),t.jsxs("div",{className:l.nextStopIndicatorEn,children:["Next ",i?"Stopping at":"Stop"]})]}),t.jsx("div",{className:l.routeHeadingGrid,children:t.jsx(Gt,{})}),t.jsx("div",{className:l.stopProgressBarGrid,children:a?t.jsx(ar,{}):((N=n==null?void 0:n.stops)==null?void 0:N.length)>0&&t.jsxs("div",{className:l.stopProgressBarContainer,children:[t.jsx(Jt,{progressBarRef:m}),t.jsx(Kt,{progressBarRef:w})]})}),t.jsx("div",{className:l.dividerGrid}),t.jsx("div",{className:l.stopNameGrid,children:o?t.jsx(Ie,{zhNameOverrideStyle:l.noticeZhOverrideStyle,enNameOverrideStyle:l.noticeEnOverrideStyle}):c?t.jsx(Fe,{zhNameOverrideStyle:l.noticeZhOverrideStyle,enNameOverrideStyle:l.noticeEnOverrideStyle}):t.jsxs(t.Fragment,{children:[t.jsx("span",{ref:h,className:l.stopNameZh,style:{fontSize:Ht(p)},children:p}),t.jsx("span",{ref:b,className:l.stopNameEn,children:x})]})}),t.jsxs("div",{className:l.driverInfoGrid,children:[t.jsxs("span",{className:l.driverInfoText,children:[d==null?void 0:d.nameZh,"車長正為您服務   Bus Captain "]}),t.jsxs("span",{className:`${l.driverInfoText} ${l.capitalize}`,children:[d==null?void 0:d.nameEn," "]}),t.jsxs("span",{className:l.driverInfoText,children:["is serving you   員工編號  Staff No.: ",d==null?void 0:d.staffNo]})]})]})},k={routeMarkerContainer:["flex flex-col","basis-[10%]","text-center","items-center"].join(" "),routeMarkerZh:["font-[500]","tracking-tighter","text-[4cqw]","max-sm:text-[4cqw]"].join(" "),routeMarkerEn:["tracking-tighter","text-[2.75cqw]","max-sm:text-[3cqw]"].join(" "),routeNumber:["basis-[17.5%]","font-[500]","text-[6.75cqw]","text-center","tracking-tight","scale-y-110"].join(" "),arrowContainer:["flex","basis-[10%]","max-xl:basis-[3.25rem]","max-sm:basis-[2rem]","justify-center"].join(" "),destContainer:["flex flex-col","mr-0.5"].join(" "),destZh:["font-[500]","whitespace-nowrap","text-[4.375cqw]","max-md:text-[4.375cqw]","max-sm:text-[5cqw]","tracking-wide","max-sm:tracking-normal"].join(" "),destEn:["font-[500]","text-sm","whitespace-nowrap","text-[2.5cqw]","max-sm:text-[2.625cqw]"].join(" ")},Gt=()=>{var n,s,a,o;const{routeDetail:e,lastStopIndex:r}=y(c=>c.routeSelection);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:k.routeMarkerContainer,children:[t.jsx("div",{className:k.routeMarkerZh,children:"路線"}),t.jsx("div",{className:k.routeMarkerEn,children:"Route"})]}),t.jsx("div",{className:k.routeNumber,children:e.route}),t.jsx("div",{className:k.arrowContainer,children:t.jsx(ir,{})}),t.jsxs("div",{className:k.destContainer,children:[t.jsx("div",{className:k.destZh,children:(s=(n=e==null?void 0:e.stops)==null?void 0:n[r])==null?void 0:s.zh}),t.jsx("div",{className:k.destEn,children:(o=(a=e==null?void 0:e.stops)==null?void 0:a[r])==null?void 0:o.en})]})]})},Zt=750,f={refContainer:"compact-progress-bar h-full",stopNameContainer:"stop-name-container @container w-full h-full relative",stopInfoRow:"stopInfoRow flex gap-1 w-full relative top-[33%] mb-[12cqw] items-center justify-center",stopInfoCol:"stopInfoCol flex flex-col gap-0.5 basis-[33%] min-w-[0] h-full justify-center",stopZh:"relative text-[2.5cqw] w-full text-center flex items-center justify-center",stopZhCurrent:"font-bold",stopEn:"relative text-[1.5cqw] w-full text-center flex items-center justify-center",stopEnCurrent:"font-black",stopEnOther:"text-black",progressBar:["progress-bar","line","flex justify-around","bg-[#FF0000]","w-[87.5%] h-[1.5cqw]","relative top-[-7cqw]","z-0"].join(" "),bullet:["bullet","bg-white","translate-x-[2cqw]","w-[1.5cqw] h-[1.5cqw]","max-sm:w-[1.75cqw] max-sm:h-[1.75cqw]","border-[1px] border-solid rounded-[50%]","relative","z-1","shrink-0"].join(" "),bulletPulse:["bulletPulse","outline outline-[0.15cqw] outline-white","border-[0.15cqw] border-[#FF0000]","!bg-[#FFFF00]","scale-125"].join(" "),bulletSecond:"bulletSecond translate-x-[7cqw]",bulletThird:"bulletThird translate-x-[11cqw]",arrowContainer:"absolute -translate-x-[37.5cqw]",arrowFirst:["absolute left-0","w-[1.5cqw] h-[1.5cqw]","border-t-[0.25vw] border-r-[0.25vw]","border-t-white border-r-white","rotate-45"].join(" "),arrowSecond:["absolute left-[1.75cqw]","w-[1.5cqw] h-[1.5cqw]","border-t-[0.25vw] border-r-[0.25vw]","border-t-white border-r-white","rotate-45"].join(" "),arrowThird:["absolute left-[3.5cqw]","w-[1.5cqw] h-[1.5cqw]","border-t-[0.25vw] border-r-[0.25vw]","border-t-white border-r-white","rotate-45"].join(" "),endIndicator:"h-[1.75cqw] border-1 border-solid border-red-600 rounded-[1px]",endIndicatorContainer:["absolute right-[-4%] top-1/2","-translate-y-1/2","flex gap-[1px]","z-10"].join(" ")},Kt=({progressBarRef:e})=>{const{routeDetail:r,currentStopIndex:n}=y(c=>c.routeSelection),[s,a]=u.useState(0),o=u.useRef(null);return u.useEffect(()=>(a(0),o.current&&clearInterval(o.current),o.current=setInterval(()=>{a(c=>c<3?c+1:0)},Zt),()=>clearInterval(o.current)),[n]),t.jsxs("div",{className:f.refContainer,ref:e,children:[t.jsx("div",{className:f.stopNameContainer,children:t.jsx("div",{className:f.stopInfoRow,children:[0,1,2].map(c=>{var d;const i=(d=r==null?void 0:r.stops)==null?void 0:d[n+c];return t.jsxs("div",{className:f.stopInfoCol,children:[t.jsx("div",{className:[f.stopZh,c===0&&f.stopZhCurrent].filter(Boolean).join(" "),children:i==null?void 0:i.zh}),t.jsx("div",{className:[f.stopEn,c===0?f.stopEnCurrent:f.stopEnOther].filter(Boolean).join(" "),children:i==null?void 0:i.en})]},c)})})}),t.jsxs("div",{className:f.progressBar,children:[t.jsxs("div",{className:f.arrowContainer,children:[s>=1&&t.jsx("div",{className:f.arrowFirst}),s>=2&&t.jsx("div",{className:f.arrowSecond}),s>=3&&t.jsx("div",{className:f.arrowThird})]}),[0,1,2].map(c=>t.jsx("div",{className:[f.bullet,c===0?f.bulletPulse:c===1?f.bulletSecond:f.bulletThird].filter(Boolean).join(" ")},c)),t.jsxs("div",{className:f.endIndicatorContainer,children:[t.jsx("div",{className:`${f.endIndicator} w-[0.25vw]`}),t.jsx("div",{className:`${f.endIndicator} w-[0.375vw]`}),t.jsx("div",{className:`${f.endIndicator} w-[0.5vw]`})]})]})]})},Ut=32,S={refContainer:"h-full",container:["line-container","@container flex","relative top-[87.5%]","w-[96.5%] h-[92%]","max-md:top-[89%]"].join(" "),startLineContainer:"flex gap-[2px] z-1",endLineContainer:["flex gap-[2px] justify-end","relative","w-full","max-md:gap-[0.5px]"].join(" "),progressBar:["@container line","flex flex-row justify-evenly","absolute left-1.5","w-[98%] h-[1.5cqw]","max-sm:w-[97%]","z-0"].join(" "),bullet:["bullet relative","bg-white border border-solid rounded-full","w-[1.5cqw] h-[1.5cqw]","z-1 shrink-0"].join(" "),bulletPulse:["animate-bullet-pulse","w-full h-full","rounded-[50%] bg-white"].join(" "),startLineBar:["bg-[gray]","w-[.2cqw] h-[2.5cqw]","max-md:w-[.375cqw] max-md:h-[3.5cqw]"].join(" "),endLineBar:["bg-[#FF0000]","w-[.2cqw] h-[2.5cqw]","max-md:w-[.375cqw] max-mx:h-[3.5cqw]"].join(" "),stopName:["stop-name absolute","text-black text-[1.75cqw]","top-[-2.75cqw] left-1/2","-translate-x-[5%] -rotate-[65deg]","origin-left whitespace-nowrap","max-md:text-[2cqw] max-md:top-[-3cqw]"].join(" "),stopNameCurrent:["font-black"].join(" "),stopNamePast:["!text-gray-300"].join(" "),splitEllipsis:["absolute text-xl","top-[-7cqw] right-[-3cqw]"].join(" ")},Vt=({stop:e,i:r,currentStopIndex:n})=>{const s=r===n,a=r<n;return t.jsxs("div",{className:S.bullet,style:{position:"relative"},children:[s&&t.jsx("div",{className:S.bulletPulse}),t.jsx("div",{className:[S.stopName,s&&S.stopNameCurrent,a&&S.stopNamePast].filter(Boolean).join(" "),children:e.zh})]})},Jt=({progressBarRef:e})=>{var h,b;const{routeDetail:r,currentStopIndex:n,isUserSelectedRoute:s}=y(l=>l.routeSelection),a=((h=r==null?void 0:r.stops)==null?void 0:h.length)??0,o=Ut,c=Math.floor(o*.8),[i,d]=Rt(a,n,o,c),p=d-i,x=n-i,m=p>1?x/(p+1)*100:0,w=a>o&&d<a;return t.jsx("div",{className:S.refContainer,ref:e,children:t.jsxs("div",{className:S.container,children:[s&&i===0&&t.jsx("div",{className:S.startLineContainer,children:[...Array(2)].map((l,j)=>t.jsx("div",{className:S.startLineBar},j))}),t.jsxs("div",{style:{background:`linear-gradient(to right, gray 0%, gray ${m}%, red ${m}%)`},className:S.progressBar,children:[(b=r==null?void 0:r.stops)==null?void 0:b.slice(i,d).map((l,j)=>t.jsx(Vt,{stop:l,i:i+j,currentStopIndex:n},i+j)),w&&t.jsx("div",{className:S.splitEllipsis,children:"..."})]}),s&&d===a&&t.jsx("div",{className:S.endLineContainer,children:[...Array(2)].map((l,j)=>t.jsx("div",{className:S.endLineBar},j))})]})})},_={parentGrid:["select-none","grid","grid-cols-[10fr_90fr]","grid-rows-[3.25fr_0.025fr_2fr_0.025fr_2fr]"].join(" "),arrowContainer:"@container text-center bg-[#FF0000]",arrowIcon:"mt-[0.5rem] justify-center",currentStopContainer:"flex flex-col bg-white"},Xt=({monitorStyle:e,screenTarget:r})=>{var d,p;const{routeDetail:n,currentStopIndex:s}=y(x=>x.routeSelection),{showMindDoorNotice:a,showHandrailNotice:o}=y(x=>x.userPreference),c=n==null?void 0:n.stops,i=[1,2].map(x=>{var m,w;return t.jsx(er,{stopZh:(m=c==null?void 0:c[s+x])==null?void 0:m.zh,stopEn:(w=c==null?void 0:c[s+x])==null?void 0:w.en},x)});return t.jsxs("div",{ref:r,className:`${_.parentGrid} ${e}`,children:[a?t.jsx(Fe,{}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:_.arrowContainer,children:t.jsx("div",{className:_.arrowIcon,children:t.jsx(Yt,{})})}),t.jsx("div",{className:_.currentStopContainer,children:t.jsx(Qt,{stopZh:(d=c==null?void 0:c[s])==null?void 0:d.zh,stopEn:(p=c==null?void 0:c[s])==null?void 0:p.en})})]}),o?t.jsx(Ie,{}):t.jsx(t.Fragment,{children:i})]})},Yt=e=>t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",shapeRendering:"geometricPrecision",textRendering:"geometricPrecision",viewBox:"0 0 160 300",...e,children:[t.jsxs("g",{fill:"#3f5787",stroke:"#fbfbfb",strokeWidth:3,children:[t.jsx("path",{d:"M-96 0H4",transform:"matrix(.64952 .375 -3.75 6.4952 82.563 45.202)"}),t.jsx("path",{d:"M-96 0H4",transform:"matrix(.64952 -.375 3.75 6.4952 136.34 10.702)"}),t.jsx("path",{d:"M-96 0H4",transform:"matrix(.64952 .375 -3.75 6.4952 82.563 91.702)"}),t.jsx("path",{d:"M-96 0H4",transform:"matrix(.64952 -.375 3.75 6.4952 136.34 57.202)"}),t.jsx("path",{d:"M-96 0H4",transform:"matrix(.64952 .375 -3.75 6.4952 82.563 138.202)"}),t.jsx("path",{d:"M-96 0H4",transform:"matrix(.64952 -.375 3.75 6.4952 136.34 103.702)"})]}),t.jsxs("g",{transform:"matrix(.75 0 0 .75 -16.586 -9.692)",children:[t.jsx("ellipse",{fill:"#fff",rx:66.997,ry:67.383,transform:"matrix(1.32296 0 0 1.29333 128.995 324.173)"}),t.jsx("ellipse",{fill:"#fffa00",stroke:"red",strokeWidth:10,rx:66.997,ry:67.383,transform:"matrix(.94385 0 0 .93055 128.995 322.985)"})]})]}),O={container:["@container","font-[500]","relative left-[1.25%]","w-[95%]","h-full","tracking-[-0.0625rem]"].join(" "),zhStopName:["h-[12cqw]","relative top-[2cqw]","flex items-center","tracking-normal"].join(" "),enStopNameWrapper:["relative top-[15%]","flex","h-[33%]","w-full","leading-tight"].join(" "),enStopName:["text-[5.125cqw]","max-md:text-[5.5cqw]","leading-[1.2]","w-full"].join(" ")},ie=(e="",r="en")=>{if(!e)return{};const n=J(e),a={en:{},zh:{min:7,base:20,scale:.66,fallback:7,max:12.5}}[r];if(!a)return{};const o={fontSize:`clamp(${a.min}cqw, ${Math.max(a.base-n*a.scale,a.fallback)}cqw, ${a.max}cqw)`};if(r==="zh")o.marginTop=`${n*.025}cqh`;else if(r==="en"){const c=n>38;o.alignSelf=c?"flex-start":"center",c&&(o.lineHeight="1.3",o.marginTop="-.5rem")}return o},Qt=({stopZh:e="",stopEn:r=""})=>t.jsxs("div",{className:O.container,children:[t.jsx("div",{className:O.zhStopName,style:ie(e,"zh"),children:e}),t.jsx("div",{className:O.enStopNameWrapper,children:t.jsx("span",{className:O.enStopName,style:ie(r,"en"),children:r})})]}),F={divider:["col-start-1","col-end-5","bg-[#f7f6f6c5]"].join(" "),stopIndicatorContainer:["@container","flex flex-col justify-center items-center","bg-[#FF0000]"].join(" "),stopIndicator:["inline-block","rounded-[50%]","bg-white","w-[65cqw] h-[65cqw]"].join(" "),stopNameContainer:["@container","relative","flex flex-col","bg-white","tracking-[-0.0375rem]"].join(" "),stopNameContent:["@container","font-[500]","relative left-[1.25%]","flex flex-col justify-center","h-[92.5%]","whitespace-nowrap"].join(" "),zhStopName:["relative","justify-center","max-md:top-[0.25cqw]","tracking-normal"].join(" "),enStopName:["justify-center","text-[3.75cqw]","max-sm:text-[3.75cqw]","sm:max-md:text-[3.75cqw]"].join(" ")},ce=(e,r,n)=>e?{zh:{fontSize:`clamp(6.8cqw, ${Math.max(18-J(e)*.5,6.75)}cqw, 8.25cqw)`},en:(()=>{const a=e.length;if(a<45)return{};const o=n<768?4:n<1280?3.75:3.5,c=a>=50?.8:.85;return{fontSize:`${o*c}cqw`}})()}[r]||{}:{},er=({stopZh:e="",stopEn:r=""})=>{const{windowSize:n}=R();return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:F.divider}),t.jsx("div",{className:F.stopIndicatorContainer,children:t.jsx("div",{className:F.stopIndicator})}),t.jsx("div",{className:F.stopNameContainer,children:t.jsxs("div",{className:F.stopNameContent,children:[t.jsx("div",{className:F.zhStopName,style:ce(e,"zh"),children:e}),t.jsx("span",{className:F.enStopName,style:ce(r,"en",n),children:r})]})})]})},Ie=({containerOverrideStyle:e="",zhNameOverrideStyle:r="",enNameOverrideStyle:n=""})=>{const s={noticeContainer:"@container w-full h-full row-span-99 col-span-2 flex flex-col items-center justify-center bg-amber-300",textZh:"text-[12cqw] mt-[-1cqw] tracking-wider font-[700]",textEn:"text-[5.5cqw] mt-[-1.5cqw] tracking-tight font-[700]"};return t.jsxs("div",{className:s.noticeContainer+" "+e,children:[t.jsx("div",{className:s.textZh+" "+r,children:"請緊握扶手"}),t.jsx("div",{className:s.textEn+" "+n,children:"Please hold the handrail"})]})},Fe=({containerOverrideStyle:e="",zhNameOverrideStyle:r="",enNameOverrideStyle:n=""})=>{const s={noticeContainer:"@container w-full h-full flex flex-col gap-1 col-span-3 justify-center items-center text-center bg-[#FF0000]",textZh:"text-[10cqw] mt-[-1cqw] text-white font-[600]",textEn:"text-[5cqw] mt-[-1.5cqw] text-white font-[600]"};return t.jsxs("div",{className:s.noticeContainer+" "+e,children:[t.jsx("div",{className:s.textZh+" "+r,children:"車門正在關上"}),t.jsx("div",{className:s.textEn+" "+n,children:"Door Closing"})]})},tr=()=>t.jsx("div",{className:"fixed inset-0 -z-10 bg-gradient-to-br from-[#32302c] via-[#32323f] to-[#212525]",children:t.jsx("svg",{width:"100%",height:"100%",className:"absolute inset-0 pointer-events-none",style:{minHeight:"100vh"}})});g.string,g.string.isRequired,g.bool,g.func.isRequired;const rr=({error:e})=>t.jsx("div",{className:"flex items-center justify-center p-4 w-full",children:t.jsxs("div",{className:"flex items-center gap-4 bg-red-50 border-l-12 border-red-500 p-4 rounded-r shadow-lg max-w-2xl",children:[t.jsx(Ge,{className:"text-red-500 text-3xl"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-red-600",children:e||"An unexpected error occurred. Please try again."}),t.jsx("button",{onClick:()=>window.location.reload(),className:"mt-3 text-sm text-red-700 hover:cursor-pointer hover:text-red-900 underline",children:"Refresh Page"})]})]})}),nr=pe(xe)(({theme:e})=>({width:"100%",padding:e.spacing(2)})),or=pe(L)(({theme:e})=>({fontSize:"0.75rem",color:"rgba(255,255,255, 0.5)",textAlign:"center",[e.breakpoints.down("sm")]:{fontSize:"0.75rem"}})),sr=()=>t.jsx(nr,{component:"footer",children:t.jsx(Ze,{maxWidth:"xl",children:t.jsx("div",{className:"select-none max-md:hidden flex items-center justify-center",children:t.jsx(or,{variant:"body2",component:"div",children:t.jsx("a",{target:"_blank",rel:"noreferrer",className:"text-gray-400/80 underline",href:"https://github.com/silverfankw/kmb-dpip",children:"silverfankw/kmb-dpip-v2 @ 2025"})})})})}),qe=({message:e="",style:r={},tailwindStyle:n=""})=>t.jsx("span",{style:r,className:`text-xs ${n}`,children:e});qe.propTypes={message:g.string.isRequired,style:g.object,tailwindStyle:g.string};const W=({id:e,type:r="text",pattern:n,validInput:s=!0,invalidMessage:a="",value:o="",style:c="",placeholder:i="",minLength:d,maxLength:p,onChange:x,onInput:m})=>t.jsxs("div",{children:[i&&t.jsx("label",{htmlFor:e,className:"text-xs text-gray-200",children:i}),t.jsx("input",{id:e,type:r,value:o,pattern:n,minLength:d,maxLength:p,className:`block bg-white text-black text-xs w-full 
                    rounded-lg border border-gray-500 py-3 pl-3 pr-10 
                    placeholder:text-gray-400 placeholder:text-xs
                    ${c}`,onChange:w=>x==null?void 0:x(w.target.value),onInput:m}),a&&!s&&o.length>0&&t.jsx(qe,{message:a,tailwindStyle:"text-red-600"})]});W.propTypes={id:g.string,type:g.string,pattern:g.string,validInput:g.bool,invalidMessage:g.string,value:g.string,style:g.string,placeholder:g.string,minLength:g.number,maxLength:g.number,onChange:g.func,onInput:g.func,submitAction:g.func};const ar=()=>t.jsx(xe,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:t.jsx(Ke,{color:"primary"})}),K=({sx:e,control:r,label:n})=>t.jsx(Ue,{sx:e,control:r,label:n}),ir=e=>t.jsx("svg",{width:"100%",height:"100%",style:{display:"block",maxWidth:"200px",height:"auto"},xmlns:"http://www.w3.org/2000/svg",shapeRendering:"geometricPrecision",textRendering:"geometricPrecision",viewBox:"0 0 200 130",...e,children:t.jsxs("g",{fill:"#fff",children:[t.jsxs("g",{transform:"translate(-714.021 -20.258)",children:[t.jsx("rect",{width:100.287,height:40.115,rx:0,ry:0,transform:"matrix(.48535 -.48535 .62202 0 727.59 131.579)"}),t.jsx("rect",{width:100.287,height:40.115,rx:0,ry:0,transform:"matrix(.49848 .49848 -.62202 0 751.225 32.957)"})]}),t.jsxs("g",{transform:"translate(-664.073 -19.578)",children:[t.jsx("rect",{width:100.287,height:40.115,rx:0,ry:0,transform:"matrix(.48535 -.48535 .62202 0 727.59 131.579)"}),t.jsx("rect",{width:100.287,height:40.115,rx:0,ry:0,transform:"matrix(.49848 .49848 -.62202 0 751.225 32.957)"})]}),t.jsxs("g",{transform:"translate(-613.467 -18.898)",children:[t.jsx("rect",{width:100.287,height:40.115,rx:0,ry:0,transform:"matrix(.48535 -.48535 .62202 0 727.59 131.579)"}),t.jsx("rect",{width:100.287,height:40.115,rx:0,ry:0,transform:"matrix(.49848 .49848 -.62202 0 751.225 32.957)"})]})]})}),C={rootContainer:"min-h-screen flex flex-col items-center",contentContainer:["select-none focus:outline-hidden","p-[2rem] max-sm:p-2","flex flex-1 flex-col gap-3 ","max-sm:gap-2"].join(" "),querySection:["order-1 max-sm:order-2","flex gap-3 items-center justify-center","bg-[#18181b]/80 backdrop-blur-md shadow-2xl ","p-6 max-md:p-4 max-md:flex-col max-md:gap-2","border border-gray-600/90 rounded-2xl"].join(" "),controlPanelSection:["order-2 max-sm:order-3","flex gap-4 flex-wrap justify-center","bg-[#18181b]/80 shadow-lg","p-6 w-full max-md:flex-col max-md:gap-4","border border-gray-600/90 rounded-2xl"].join(" "),screenPanelSection:["order-3 max-sm:order-1","flex flex-wrap items-center justify-center","gap-10 max-sm:gap-6 py-4"].join(" "),asyncSelectWrapper:"flex items-center gap-4 w-full",monitorStyle:["w-[800px] h-[480px]","max-xl:w-[700px] max-xl:h-[420px]","max-md:w-[600px] max-md:h-[360px]","max-sm:w-[400px] max-sm:h-[240px]","shadow-[0.5rem_0.5rem_1rem_0.25rem_#23272f]","border-[.375rem] max-md:border-[.25em] border-solid border-[#23272f]","rounded-xl","outline outline-[0.875rem] max-sm:outline-[0.625rem] outline-[#000000]","z-1"].join(" ")},cr=()=>{const e=ue(),r=T();u.useEffect(()=>{r(dt())},[r]);const{hasStoredData:n,storedData:s,saveToLocalStorage:a}=Et(),{isUserSelectedRoute:o,loadingError:c,routeDetail:i,currentStopIndex:d}=y(h=>h.routeSelection),{routes:p}=y(h=>h.route),x=u.useCallback(async()=>{if(s&&p.length>0)try{r(Y({routeDetail:s,routes:p})),r(U(s.currentStopIndex||0))}catch(h){console.error("Error restoring selection:",h)}},[r,s,p]);u.useEffect(()=>{n&&p.length>0&&x()},[n,p,x]),u.useEffect(()=>{var h,b;if(o&&i&&Object.keys(i).length>0){const l={route:i.route,bound:i.bound,service_type:i.service_type,orig_tc:i.orig_tc,orig_en:i.orig_en,dest_tc:i.dest_tc,dest_en:i.dest_en,specialRemark:i.specialRemark,currentStop_tc:((h=i.stops[d])==null?void 0:h.zh)||"",currentStop_en:((b=i.stops[d])==null?void 0:b.en)||"",currentStopIndex:d,timestamp:Date.now()};a(l)}},[o,i,d,a]),u.useEffect(()=>{const h=()=>{var b,l;if(o&&i&&Object.keys(i).length>0){const j={route:i.route,bound:i.bound,service_type:i.service_type,orig_tc:i.orig_tc,orig_en:i.orig_en,dest_tc:i.dest_tc,dest_en:i.dest_en,specialRemark:i.specialRemark,currentStop_tc:((b=i.stops[d])==null?void 0:b.zh)||"",currentStop_en:((l=i.stops[d])==null?void 0:l.en)||"",currentStopIndex:d,timestamp:Date.now()};a(j)}};return window.addEventListener("beforeunload",h),()=>window.removeEventListener("beforeunload",h)},[o,i,d,a]);const m=u.useRef(null),w=u.useRef(null);return qt({onPrev:()=>r(je()),onNext:()=>r(ye()),onHome:()=>r(U(0)),onEnd:()=>r(we()),isUserSelectedRoute:o,debounceMs:100,isDisabled:!1}),t.jsxs(t.Fragment,{children:[t.jsx(tr,{}),t.jsxs("div",{className:C.rootContainer,children:[t.jsxs("div",{className:C.contentContainer,tabIndex:1,children:[t.jsx("section",{className:C.querySection,children:t.jsxs("div",{className:C.asyncSelectWrapper,children:[t.jsx(Ve,{sx:{color:"#999",fontSize:24,[e.breakpoints.down("sm")]:{display:"none"}}}),t.jsx("div",{className:"flex-1",children:t.jsx($t,{})})]})}),t.jsx("section",{className:C.controlPanelSection,children:t.jsx(It,{mainScreenTarget:m,secScreenTarget:w})}),t.jsx("section",{className:C.screenPanelSection,children:c?t.jsx(rr,{error:c}):t.jsxs(t.Fragment,{children:[t.jsx(Dt,{monitorStyle:C.monitorStyle,screenTarget:m}),t.jsx(Xt,{monitorStyle:C.monitorStyle,screenTarget:w})]})})]}),t.jsx(sr,{})]})]})};Re.createRoot(document.getElementById("root")).render(t.jsx(Me,{store:kt,children:t.jsx(Ee,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:t.jsx(Je,{theme:Ct,children:t.jsx(cr,{})})})}));
