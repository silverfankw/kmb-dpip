import{j as t,r as u,c as ce}from"./react-DLwQdj7q.js";import{a as Ce}from"./react-dom-Bpij0FWw.js";import{B as Ie}from"./react-router-dom-Bjp-w-kY.js";import{u as S,a as B,P as Fe}from"./react-redux-BsdHwLJa.js";import{c as J,a as le,b as Re}from"./@reduxjs-NaPybp_z.js";import{c as qe,u as de,a as Ee,T as $,B as P,b as Te,F as $e,N as Pe,d as W,S as H,H as Me,D as Be,A as _e,e as ze,C as Oe,R as Le,E as We,s as ue,f as pe,g as Ae,h as He,i as De,j as Ge,k as Ze}from"./@mui-gEQS-3Z-.js";import{d as xe}from"./lodash-D9Xc9Uuo.js";import{c as Q,A as Ke}from"./react-select-Cfw0BZ38.js";import{P as j}from"./prop-types-D7IYfoA1.js";import{s as V}from"./string-width-BwHzav8R.js";import"./@babel-3BxVu_ax.js";import"./scheduler-SPyfQU6S.js";import"./react-router-CV6FO8-_.js";import"./@remix-run-BBWqMfS0.js";import"./use-sync-external-store-BCKmAaC2.js";import"./redux-BXkGT1VS.js";import"./immer-DqxjFn0G.js";import"./redux-thunk-ClJT1hhx.js";import"./@emotion-_JA2SG62.js";import"./hoist-non-react-statics-C-Qo8PK8.js";import"./stylis-DDa9OTMq.js";import"./clsx-B-dksMZM.js";import"./react-transition-group-CndzbEAZ.js";import"./@popperjs-CMBiYTiD.js";import"./react-is-BPJnJB5S.js";import"./@floating-ui-Dqirgmo9.js";import"./use-isomorphic-layout-effect-8A7Cpl8G.js";import"./memoize-one-BdPwpGay.js";import"./get-east-asian-width-R4ibU9pT.js";import"./emoji-regex-D90yNSKR.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();const Ue=/\([A-Z]{2}\d{3}\)$/,ee=e=>e.replace(Ue,"").trim(),Je=e=>{const r=e.data.name_en,n=e.data.name_tc;return{en:ee(r),zh:ee(n)}},Ve=(e,r="number")=>{var s;return e&&(((s={number:{O:"1",I:"2"},letter:{1:"O",2:"I"}}[r])==null?void 0:s[e])||e)},Xe=e=>e&&String(parseInt(e,10)),M="｜",X="往",me="特別班",Ye="Desc_CHI",D=new Map;async function Qe(){const e=await fetch("https://data.etabus.gov.hk/v1/transport/kmb/route/");if(!e.ok)throw new Error(`HTTP error! status: ${e.status} ${e.statusText}`);return(await e.json()).data}async function et(e,r,n){return(await(await fetch(`https://data.etabus.gov.hk/v1/transport/kmb/route-stop/${e}/${r==="I"||r==="inbound"?"inbound":"outbound"}/${n}`)).json()).data.map(c=>c.stop)}async function tt(e){if(D.has(e))return D.get(e);try{const r=await fetch(`https://data.etabus.gov.hk/v1/transport/kmb/stop/${e}`);if(!r.ok)throw new Error(`HTTP error! status: ${r.status} ${r.statusText}`);const n=await r.json(),s=Je(n);return D.set(e,s),s}catch(r){throw console.error(`Error when fetching stop detail for stopID: ${e}`,r),r}}async function rt(e){return Promise.all(e.map(tt))}async function nt(e,r,n){var i,l;const s=Ve(r,"number"),a=await fetch(`https://search.kmb.hk/KMBWebSite/Function/FunctionRequest.ashx?action=getSpecialRoute&route=${e}&bound=${s}`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status} ${a.statusText}`);const c=(l=(i=(await a.json()).data)==null?void 0:i.routes)==null?void 0:l.find(({Route:p,Bound:x,ServiceType:h})=>e===p&&s===x&&n===Xe(h==null?void 0:h.trim()));return(c==null?void 0:c[Ye])??""}const ot={routes:[],isLoading:!1,error:null},st=()=>async e=>{e(te(!0));try{const r=await Qe(),n=new Map(r.map(o=>[`${o.route}-${o.bound}-${o.service_type}`,o])),s=r.filter(o=>o.service_type!=="1").map(async o=>{const c=await nt(o.route,o.bound,o.service_type),i=`${o.route}-${o.bound}-${o.service_type}`;n.set(i,{...o,specialRemark:c})});await Promise.all(s);const a=Array.from(n.values());localStorage.setItem("routes",JSON.stringify(a)),e(fe(a))}catch(r){console.error("Error fetching routes:",r),e(it(r.message))}finally{e(te(!1))}},at=()=>async e=>{const r=localStorage.getItem("routes");if(r){e(fe(JSON.parse(r)));return}e(st())},he=J({name:"route",initialState:ot,reducers:{setRoutes:(e,r)=>{e.routes=r.payload},setLoading:(e,r)=>{e.isLoading=r.payload},setError:(e,r)=>{e.error=r.payload}}}),{setRoutes:fe,setLoading:te,setError:it}=he.actions,ct=he.reducer,lt={routeDetail:{},currentStopIndex:0,lastStopIndex:0,isUserSelectedRoute:!1,routeHasTwoBound:!1,isLoading:!1,loadingError:null},dt=e=>e.routeSelection.currentStopIndex>0,ut=e=>e.routeSelection.currentStopIndex<e.routeSelection.lastStopIndex,Y=le("routeSelection/selectRoute",async({routeDetail:e,routes:r},{dispatch:n})=>{n(re(!0)),n(ne(null));try{const{route:s,bound:a,service_type:o,orig_tc:c,orig_en:i,dest_tc:l,dest_en:p,specialRemark:x}=e,h=r.some(g=>g.bound==="I"&&g.route===s)&&r.some(g=>g.bound==="O"&&g.route===s);n(ht(h));const b=await et(s,a,o),f=await rt(b);n(U(0)),n(pt({route:s,bound:a,stops:f,orig_tc:c,orig_en:i,dest_tc:l,dest_en:p,service_type:o,specialRemark:x})),n(mt(!0))}catch(s){n(ne(s.message))}finally{n(re(!1))}}),ge=le("routeSelection/changeBound",async(e,{getState:r,dispatch:n})=>{const s=r().routeSelection,a=r().route.routes,{routeDetail:o,routeHasTwoBound:c,isUserSelectedRoute:i}=s;if(i&&(c||(o==null?void 0:o.service_type)===1)){const{bound:l,orig_tc:p,dest_tc:x}=o;n(Y({routeDetail:{...o,bound:l==="I"?"O":"I",dest_tc:p,orig_tc:x},routes:a}))}}),we=J({name:"routeSelection",initialState:lt,reducers:{setRouteDetail(e,r){var n;e.routeDetail=r.payload,e.lastStopIndex=(((n=r.payload.stops)==null?void 0:n.length)??1)-1},setCurrentStopIndex(e,r){e.currentStopIndex=r.payload},toPrevStop(e){e.currentStopIndex>0&&(e.currentStopIndex-=1)},toNextStop(e){e.currentStopIndex<e.lastStopIndex&&(e.currentStopIndex+=1)},resetToFirstStop(e){e.currentStopIndex=0},setIsUserSelectedRoute(e,r){e.isUserSelectedRoute=r.payload},setRouteHasTwoBound(e,r){e.routeHasTwoBound=r.payload},setIsLoading:(e,r)=>{e.isLoading=r.payload},setLoadingError:(e,r)=>{e.loadingError=r.payload}}}),{setRouteDetail:pt,setCurrentStopIndex:U,toPrevStop:be,toNextStop:je,resetToFirstStop:xt,setIsUserSelectedRoute:mt,setRouteHasTwoBound:ht,setIsLoading:re,setLoadingError:ne}=we.actions,ft=we.reducer,gt={stopPressed:!1,driverInfo:{nameZh:"九巴仔",nameEn:"KMB Boy",staffNo:"1933"},customizeDriverInfoToggle:!1,showMindDoorNotice:!1,showHandrailNotice:!1},ye=J({name:"userPreference",initialState:gt,reducers:{setStopPressed(e,r){e.stopPressed=r.payload},setDriverInfo(e,r){e.driverInfo={...e.driverInfo,...r.payload}},setCustomizeDriverInfoToggle(e,r){e.customizeDriverInfoToggle=r.payload},setShowMindDoorNotice(e,r){e.showMindDoorNotice=r.payload},setShowHandrailNotice(e,r){e.showHandrailNotice=r.payload},setShowHandrailAndMindDoorNotice(e,r){e.showHandrailNotice=r.payload.showHandrailNotice,e.showMindDoorNotice=r.payload.showMindDoorNotice}}}),{setStopPressed:wt,setDriverInfo:G,setCustomizeDriverInfoToggle:bt,setShowMindDoorNotice:zr,setShowHandrailNotice:Or,setShowHandrailAndMindDoorNotice:oe}=ye.actions,jt=ye.reducer,yt=Re({reducer:{route:ct,routeSelection:ft,userPreference:jt}}),St=qe({breakpoints:{values:{xs:480,sm:640,md:768,lg:1024,xl:1280,"2xl":1536,"3xl":1920}},typography:{fontFamily:"Noto Sans, sans-serif"},palette:{darkRed:{main:"#A81919",light:"#EF4444",dark:"#991212",contrastText:"#FFF1F2"},nextGreen:{main:"#089314",light:"#147738",dark:"#077F11",contrastText:"#FFFFFF"},directionPurple:{main:"#822093",light:"#B983D6",dark:"#701C7F",contrastText:"#F3E8FF"},ochre:{main:"#E3D026",light:"#FFF176",dark:"#C4B121",contrastText:"#262A33"},snowwhite:{main:"#FFFFFF"}}}),_={groupWrapper:"flex flex-wrap gap-5 max-md:gap-3 justify-center",switchGroupWrapper:"!gap-4",driverInfoSection:"flex text-center items-center text-white gap-3"},vt=({mainScreenTarget:e,secScreenTarget:r})=>{const n=S(s=>s.userPreference);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:_.groupWrapper,children:t.jsx(Ot,{})}),t.jsx("div",{className:_.groupWrapper+" "+_.switchGroupWrapper,children:t.jsx(zt,{})}),t.jsx("div",{className:_.groupWrapper,children:t.jsx(_t,{mainScreenTarget:e,secScreenTarget:r})}),n.customizeDriverInfoToggle&&t.jsx("section",{className:_.driverInfoSection,children:t.jsx(Nt,{})})]})},Nt=()=>{const{driverInfo:e}=S(n=>n.userPreference),r=B();return t.jsxs(t.Fragment,{children:[t.jsx(A,{placeholder:"車長中文姓氏 (最多2字)",maxLength:2,value:e==null?void 0:e.nameZh,defaultValue:e==null?void 0:e.nameZh,onChange:n=>{n==""&&(n="九巴仔"),r(G({nameZh:n}))}}),t.jsx(A,{style:"capitalize",placeholder:"車長英文姓氏 (最多10字)",maxLength:10,value:e==null?void 0:e.nameEn,defaultValue:e==null?void 0:e.nameEn,onChange:n=>{n==""&&(n="KMB Boy"),r(G({nameEn:n}))}}),t.jsx(A,{placeholder:"職員編號 (1位至6位數字)",type:"number",minLength:1,maxLength:6,value:e==null?void 0:e.staffNo,defaultValue:e==null?void 0:e.staffNo,onInput:n=>n.target.value=Math.abs(n.target.value.slice(0,6)),onChange:n=>{n==""&&(n="1933"),r(G({staffNo:n}))}})]})},kt=({onPrev:e,onNext:r,onHome:n,onEnd:s,isUserSelectedRoute:a=!0,debounceMs:o=50,isDisabled:c=!1})=>{const i=u.useRef(null),l=u.useCallback(p=>{if(!(i.current||c)){switch(p){case"ArrowLeft":e==null||e();break;case"ArrowRight":r==null||r();break;case"Home":n==null||n();break;case"End":s==null||s();break;default:return}i.current=setTimeout(()=>{i.current=null},o)}},[e,r,n,s,o,c]);u.useEffect(()=>{if(!a)return;const p=x=>l(x.key);return window.addEventListener("keydown",p),()=>{window.removeEventListener("keydown",p),i.current&&(clearTimeout(i.current),i.current=null)}},[l,a])},Ct=(e,r,n,s)=>u.useMemo(()=>e<=n?[0,e]:r<s?[0,n]:r>=e-n?[e-n,e]:[r-s+1,r-s+1+n],[e,r,n,s]),It=()=>{const[e,r]=u.useState(!1),[n,s]=u.useState(null);return u.useEffect(()=>{const c=localStorage.getItem("userSelection");if(c)try{const i=JSON.parse(c);s(i),r(!0)}catch(i){console.error("Error parsing stored data:",i),localStorage.removeItem("userSelection")}},[]),{hasStoredData:e,storedData:n,saveToLocalStorage:c=>{try{localStorage.setItem("userSelection",JSON.stringify(c))}catch(i){console.error("Error saving to localStorage:",i)}},clearStoredData:()=>{localStorage.removeItem("userSelection"),r(!1),s(null)}}},Ft={regular:{},xhtEhc:{backgroundColor:"#CF0001"},marathon:{backgroundColor:"#CF0001"},whc:{backgroundColor:"#027233"},airport:{backgroundColor:"#0A2163",color:"#E3D026"},external:{backgroundColor:"#ff5000"},overnight:{backgroundColor:"#000000"},airportOvernight:{backgroundColor:"#000000",color:"#DED702"},premier:{backgroundColor:"#E5B034"},shuttle:{backgroundColor:"#EB5136",color:"#0E2775"},disneyRecreational:{backgroundColor:"#146FD1"},r8:{backgroundColor:"#72C8E5",color:"#1C2EB5"},awe:{backgroundColor:"#6F2F9F"}},Rt=[{type:"regular",regex:/^(331)[S]?/},{type:"xhtEhc",regex:/^[136]\d{2}[A-Z]?$/},{type:"whc",regex:/^9(?!17|18|45$)\d{2}[A-Z]?$/},{type:"overnight",regex:/^(N(?!A)[A-Z0-9]+|270S|271S|293S)$/i},{type:"airport",regex:/^A/},{type:"airportOvernight",regex:/^NA/},{type:"external",regex:/^E/},{type:"shuttle",regex:/^S(?!P)/},{type:"premier",regex:/^P96[08]$/},{type:"disneyRecreational",regex:/^R(33|42)$/i},{type:"r8",regex:/^R8$/i},{type:"marathon",regex:/^R(108|603|673|678|680|934|936|948|960|961|968)$/i},{type:"awe",regex:/^X(33|36|40|43|47)$/i}],qt=()=>{const{isMobile:e}=E(),r=u.useMemo(()=>e?"mobile":"desktop",[e]),n=u.useMemo(()=>({display:"inline-block",textAlign:"center",color:"#FFFFFF",width:e?"42px":"52px",borderRadius:"2px",fontWeight:700}),[e]),s=u.useMemo(()=>({...Ft,shared:n}),[n]),a=u.useMemo(()=>new Map,[]);return u.useMemo(()=>c=>{const i=`${c}-${r}`;if(a.has(i))return a.get(i);const l=Rt.find(x=>x.regex.test(c)),p={...s.shared,...s[(l==null?void 0:l.type)??"regular"]};return a.set(c,p),p},[s,a,r])},E=()=>{const[e,r]=u.useState({width:window.innerWidth,height:window.innerHeight,isMobile:window.innerWidth<=768}),n=u.useMemo(()=>xe(()=>{r({width:window.innerWidth,height:window.innerHeight,isMobile:window.innerWidth<=768})},150),[]);return u.useEffect(()=>(window.addEventListener("resize",n),()=>{n.cancel(),window.removeEventListener("resize",n)}),[n]),e},se=(e,r,n,s=[])=>{u.useEffect(()=>{e.current&&r.current&&(e.current.style.display="block",r.current.style.display="none");const o=setInterval(()=>{if(e.current&&r.current){const c=e.current.style.display!=="none";e.current.style.display=c?"none":"block",r.current.style.display=c?"block":"none"}},n);return()=>clearInterval(o)},s)},Et=e=>{const r=e.service_type!=1?me:"",n=e.specialRemark??"";return`${e.route}${M} ${e.orig_tc} ${X} ${e.dest_tc} ${M}${r}${M}${n}`},Z=e=>({label:Et(e),value:`${e.route}-${e.bound}-${e.service_type}`,detail:e}),Se=({componentType:e,data:r,...n})=>{const{isMobile:s}=E(),{label:a}=r,[o,c,i,l=""]=a.split(M),[p,x]=c.split(X),h=e==="Option"?Q.Option:Q.SingleValue,b=u.useMemo(()=>({display:"flex",gap:s?"2px":"4px",alignItems:"center",fontSize:s?"14px":"18px",fontWeight:500,minWidth:0}),[s]);return t.jsx(h,{...n,data:r,children:t.jsxs("div",{style:b,children:[t.jsx(Mt,{route:o,isSpecial:i==null?void 0:i.includes(me),componentType:e,isMobile:s}),t.jsx(Bt,{origin:p,destination:x,remark:l})]})})},Tt=ce.memo(e=>t.jsx(Se,{...e,componentType:"Option"})),$t=ce.memo(e=>t.jsx(Se,{...e,componentType:"SingleValue"})),Pt=()=>{const{isMobile:e}=E(),r=B(),{routes:n}=S(d=>d.route),{routeDetail:s}=S(d=>d.routeSelection),[a,o]=u.useState(null),[c,i]=u.useState([]),[l,p]=u.useState(!1),x=u.useRef(new Map);u.useEffect(()=>{s&&Object.keys(s).length>0&&o(Z(s))},[s]);const h=u.useMemo(()=>{var d;return(d=n==null?void 0:n.slice(0,50))==null?void 0:d.map(Z)},[n]),b=u.useMemo(()=>xe((d,y)=>{const I=(d==null?void 0:d.toUpperCase())||"";if(x.current.has(I)){const N=x.current.get(I);i(N),y(N),p(!1);return}setTimeout(()=>{try{const T=(d?n.filter(F=>F.route.toUpperCase().startsWith(I)):n.slice(0,50)).slice(0,50).map(F=>Z(F,!1));x.current.set(I,T),i(T),y(T),p(!1)}catch(N){console.error("Search error:",N),p(!1)}},0)},150),[n]);u.useEffect(()=>{const d=x.current;return()=>{b.cancel(),d.clear()}},[b]);const f=u.useCallback((d,y)=>{p(!0),b(d,y)},[b]),g=u.useCallback(d=>{if(!d){o(null);return}r(Y({routeDetail:d.detail,routes:n})),o(d)},[r,n]),m=u.useMemo(()=>({control:(d,y)=>({...d,backgroundColor:"rgba(24, 27, 27, 0.5)",color:"#fff",boxShadow:y.isFocused?"0 0 0 2px #2563eb":d.boxShadow,height:e?36:42,minHeight:e?36:42,border:`2px solid ${y.isFocused?"#2563eb":"#444"}`}),menu:d=>({...d,backgroundColor:"rgba(35, 39, 47, 0.85)",color:"#fff",zIndex:9999,fontSize:e?"14px":d.fontSize}),placeholder:d=>({...d,color:"#777",opacity:1}),option:(d,y)=>({...d,border:`2px solid ${y.isFocused?"#2563eb":"transparent"}`,borderRadius:"6px",backgroundColor:y.isFocused?"rgba(0, 0, 0, 1)":"rgba(32, 36, 38, 0.9)",color:"#fff"}),input:d=>({...d,color:"#fff"}),singleValue:d=>({...d,color:"#fff"}),indicatorSeparator:(d,y)=>({...d,backgroundColor:y.isFocused?"#2563eb":"#444"}),dropdownIndicator:(d,y)=>({...d,color:y.isFocused?"#2563eb":"#444","&:hover":{color:"#444"}}),clearIndicator:(d,y)=>({...d,color:y.isFocused?"#2563eb":"#444","&:hover":{color:"#999"}})}),[e]);return t.jsx(Ke,{components:{Option:Tt,SingleValue:$t},classNamePrefix:"routeInputSelect",menuPortalTarget:document.body,styles:m,autoFocus:!0,isClearable:!0,cacheOptions:!0,defaultOptions:c.length?c:h,placeholder:"輸入九巴路線編號　Input KMB route.",loadingMessage:()=>"搜尋路線中...",isLoading:l,filterOption:null,loadOptions:f,value:a,onChange:g})},Mt=({route:e,isSpecial:r,componentType:n})=>{const{isMobile:s}=E(),a=qt(),o=u.useMemo(()=>({routeLabel:{display:n==="Option"?"inline-flex":"flex",flexDirection:n==="Option"?"column":"row",gap:n==="Option"?0:"4px",width:n==="Option"?s?"36px":"52px":"fit-content",alignItems:"center",justifyContent:"center",letterSpacing:"-0.25px",minWidth:s?"40px":"52px",position:"relative",transform:"scale(1, 1.1)"},specialTrip:{marginTop:"2px",fontSize:s?"10px":"12px",padding:s?"1px 4px":"2px 6px",border:"1px solid rgba(8, 28, 81, 1)",borderRadius:"4px",backgroundColor:"rgba(255, 214, 0, 0.75)",color:"#000",lineHeight:1.1,maxWidth:"100%",textAlign:"center"}}),[s,n]);return t.jsxs("div",{style:o.routeLabel,children:[t.jsx("span",{style:a(e),children:e}),r&&t.jsx("span",{style:o.specialTrip,children:"特別班"})]})},Bt=({origin:e,destination:r,remark:n})=>{const{isMobile:s}=E(),a=u.useMemo(()=>({wrapper:{display:"inline-flex",letterSpacing:s?"0":"0.25px",alignItems:"center",gap:s?"4px":"8px",minWidth:0,flexWrap:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},special:{fontSize:s?"12px":"15px",textAlign:"center",maxWidth:s?"120px":"none",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},to:{fontSize:s?"10px":"14px",marginTop:"1.5px",fontWeight:400}}),[s]);return t.jsxs(t.Fragment,{children:[t.jsx("span",{children:M}),t.jsxs("div",{style:a.wrapper,children:[e,t.jsx("span",{style:a.to,children:X}),r]}),t.jsx("span",{children:M}),n&&t.jsx("span",{style:a.special,children:n})]})},q=e=>{const r=de(),{isMobile:n}=E();return u.useMemo(()=>{var s;return{button:{margin:0,backgroundColor:a=>{var o;return((o=a.palette[e])==null?void 0:o.main)||a.palette.primary.main},color:a=>{var o;return(o=a.palette[e])==null?void 0:o.contrastText},borderRadius:2,boxShadow:"0 2px 8px 0 rgba(0,0,0,0.10)",fontFamily:"Zen Kaku Gothic Antique",fontWeight:500,fontSize:n?"1.1rem":"1rem",height:n?"64px":"48px",px:2,py:1,textTransform:"none",transition:"all 0.2s ease-in-out",outline:"none","&:hover":{backgroundColor:a=>{var o;return((o=a.palette[e])==null?void 0:o.dark)||a.palette.primary.dark},boxShadow:"0 6px 24px 0 rgba(37,99,235,0.18)",filter:"brightness(1.08)",transform:"translateY(-2px) scale(1.04)",outline:`2.5px solid ${(s=r.palette[e])==null?void 0:s.dark}`,outlineOffset:"1px"},"&:focus-visible":{outline:"2.5px solid #2563eb",outlineOffset:"1px"},"&:active":{boxShadow:"0 1px 4px 0 rgba(0,0,0,0.12)",filter:"brightness(0.97)",transform:"scale(0.98)"},"&.Mui-disabled":{backgroundColor:"#2d2b2b !important",color:"#595555 !important",boxShadow:"none",opacity:1,border:"1px solid #2d2b2b",cursor:"not-allowed"}},label:{fontSize:n?"1.25rem":"1rem",whiteSpace:"nowrap",fontFamily:"Zen Kaku Gothic Antique",fontWeight:500},labelWrapper:{display:"flex",alignItems:"center",gap:6},switch:{"& .MuiSwitch-switchBase.Mui-checked":{color:a=>{var o;return((o=a.palette[e])==null?void 0:o.light)||a.palette.primary.light},"&:hover":{backgroundColor:a=>{var o;return Ee(((o=a.palette[e])==null?void 0:o.light)||a.palette.primary.light,.08)}}},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:a=>{var o;return((o=a.palette[e])==null?void 0:o.dark)||a.palette.primary.dark},opacity:.75},transform:n?"scale(1.5)":"scale(1.1)"},switchLabel:{display:"flex",alignItems:"center",gap:n?2:1}}},[e,n,r])},_t=({mainScreenTarget:e,secScreenTarget:r})=>{const{isUserSelectedRoute:n}=S(i=>i.routeSelection),{customizeDriverInfoToggle:s}=S(i=>i.userPreference),a=B(),o=q("info"),c=[{key:"main",target:e,label:"主螢幕全螢幕"},{key:"sec",target:r,label:"輔螢幕全螢幕"}];return t.jsxs(t.Fragment,{children:[t.jsx($,{arrow:!0,placement:"bottom-start",title:"自定義車長資料顯示",children:t.jsx("span",{children:t.jsx(P,{sx:o.button,color:"ochre",variant:"contained",startIcon:t.jsx(Te,{}),onClick:()=>{a(bt(!s))},children:t.jsx("span",{className:o.label,children:"更改車長資料"})})})}),c.map(({key:i,target:l,label:p})=>t.jsx($,{className:o.fullscreenTooltip,arrow:!0,placement:"bottom-start",title:"選擇路線後才能開啟全螢幕顯示功能",children:t.jsx("span",{children:t.jsx(P,{sx:{...o.button,display:{xs:"none",md:"inline-block"}},color:"info",variant:"contained",disabled:!n,className:o.button,startIcon:t.jsx($e,{}),onClick:()=>{l.current.requestFullscreen()},children:t.jsx("span",{children:p})})})},i))]})},zt=()=>{const{stopPressed:e,showHandrailNotice:r,showMindDoorNotice:n}=S(c=>c.userPreference),s=B(),a=q("darkRed"),o=q("ochre");return t.jsxs(t.Fragment,{children:[t.jsx(K,{sx:a.button,control:t.jsx(H,{checked:e,onChange:()=>s(wt(!e)),name:"stop pressed",sx:a.switch}),label:t.jsxs("span",{style:a.labelWrapper,children:[t.jsx(Pe,{color:"snowwhite"}),t.jsx(W,{variant:"button",sx:a.label,children:e?"  解除":" 按鐘"})]})}),t.jsx(K,{sx:o.button,control:t.jsx(H,{checked:r,color:"gold",onChange:()=>{s(oe({showHandrailNotice:!r,showMindDoorNotice:n&&!1}))},name:"handrail notice",sx:o.switch}),label:t.jsxs("span",{style:o.labelWrapper,children:[t.jsx(Me,{}),t.jsx(W,{sx:o.label,variant:"button",children:"請緊握扶手"})]})}),t.jsx(K,{sx:o.button,control:t.jsx(H,{checked:n,color:"gold",onChange:()=>{s(oe({showMindDoorNotice:!n,showHandrailNotice:r&&!1}))},name:"mind door notice",sx:o.switch}),label:t.jsxs("span",{style:o.labelWrapper,children:[t.jsx(Be,{}),t.jsx(W,{sx:o.label,variant:"button",children:"車門正在關上"})]})})]})},Ot=()=>{const e=B(),{currentStopIndex:r,isUserSelectedRoute:n,routeDetail:s,routeHasTwoBound:a}=S(h=>h.routeSelection),o=S(dt),c=S(ut),i=q("nextGreen"),l=q("darkRed"),p=q("ochre"),x=q("directionPurple");return t.jsxs(t.Fragment,{children:[t.jsx($,{arrow:!0,placement:"bottom-start",title:"上一站 鍵盤快捷鍵: '←'",children:t.jsx("span",{children:t.jsx(P,{color:"darkRed",variant:"contained",sx:l.button,startIcon:t.jsx(_e,{}),onClick:()=>e(be()),disabled:!o,children:t.jsx("span",{className:l.buttonLabel,children:"上站"})})})}),t.jsx($,{arrow:!0,placement:"bottom-start",title:"下一站 鍵盤快捷鍵: '→'",children:t.jsx("span",{children:t.jsx(P,{color:"nextGreen",variant:"contained",sx:i.button,startIcon:t.jsx(ze,{}),onClick:()=>e(je()),disabled:!c,children:t.jsx("span",{className:i.buttonLabel,children:"下站"})})})}),t.jsx($,{arrow:!0,placement:"bottom-start",title:"切換路線方向 鍵盤快捷鍵: 'END'",children:t.jsx("span",{children:t.jsx(P,{color:"directionPurple",variant:"contained",sx:x.button,startIcon:t.jsx(Oe,{}),onClick:()=>e(ge()),disabled:!n||!a||(s==null?void 0:s.service_type)!=1,children:t.jsx("span",{className:x.buttonLabel,children:"方向"})})})}),t.jsx($,{arrow:!0,placement:"bottom-start",title:"重設至首站 鍵盤快捷鍵: 'HOME'",children:t.jsx("span",{children:t.jsx(P,{className:p.button,color:"ochre",variant:"contained",startIcon:t.jsx(Le,{}),sx:p.button,onClick:()=>e(xt()),disabled:!n||r==0,children:t.jsx("span",{className:p.buttonLabel,children:"首站"})})})})]})},Lt=11e3,Wt=4500,z={parentGrid:["select-none","grid","grid-rows-[0.5fr_1.85fr_0.0375fr_1fr_0.125fr]"].join(" "),nextStopIndicatorGrid:["@container","col-start-1 col-end-2","flex flex-col items-center justify-center","text-center"].join(" "),nextStopIndicatorZh:["text-[15cqw]","mb-[-4px]","font-[600]","max-sm:text-[16cqw]","max-sm:mb-[-1px]"].join(" "),nextStopIndicatorEn:["text-[7.5cqw]","max-sm:text-[9cqw]","font-[400]"].join(" "),routeHeadingGrid:["@container","col-start-2 col-end-5","flex items-center gap-1","pl-0.5","bg-black text-white"].join(" "),stopProgressBarGrid:["@container","col-start-1 col-end-5","bg-white"].join(" "),stopProgressBarContainer:["h-full","font-[400]","text-center","tracking-tight"].join(" "),dividerGrid:["col-start-1 col-end-5","bg-black"].join(" "),stopNameGrid:["@container","col-start-1 col-end-5","bg-white","flex justify-center items-center"].join(" "),stopNameZh:["font-[500]","text-[8cqw]","max-sm:text-[8.5cqw]","max-md:text-[10cqw]","tracking-wider","whitespace-nowrap overflow-hidden"].join(" "),stopNameEn:["text-center","font-[500]","text-[5cqw]","max-sm:text-[4cqw]","max-md:text-[5cqw]"].join(" "),driverInfoGrid:["@container","flex justify-center","col-start-1 col-end-5","font-[400]","text-white","p-0.5"].join(" "),driverInfoText:["text-[2cqw]","max-md:text-[2.25cqw]"].join(" "),capitalize:"capitalize",noticeZhOverrideStyle:"!text-[8cqw]",noticeEnOverrideStyle:"!text-[3.75cqw]"},At=e=>{const r=V(e||"");return`clamp(2rem, ${Math.max(16-r*.45,6.5)}cqw, 10cqw)`},Ht=({monitorStyle:e,screenTarget:r})=>{var d,y,I,N,T;const{routeDetail:n,currentStopIndex:s,isLoading:a}=S(F=>F.routeSelection),{showHandrailNotice:o,showMindDoorNotice:c,stopPressed:i,driverInfo:l}=S(F=>F.userPreference),p=(y=(d=n==null?void 0:n.stops)==null?void 0:d[s])==null?void 0:y.zh,x=(N=(I=n==null?void 0:n.stops)==null?void 0:I[s])==null?void 0:N.en,h=u.useRef(null),b=u.useRef(null),f=u.useRef(null),g=u.useRef(null);se(h,b,Lt,[n==null?void 0:n.route,n==null?void 0:n.bound,n==null?void 0:n.service_type]),se(f,g,Wt,[n==null?void 0:n.route,n==null?void 0:n.bound,n==null?void 0:n.service_type]),u.useEffect(()=>{o||c?(f.current&&(f.current.style.display="none"),g.current&&(g.current.style.display="none")):(f.current&&(f.current.style.display="block"),g.current&&(g.current.style.display="none"))},[o,c]);const m={...z,parentGrid:`${z.parentGrid} ${e}`,nextStopIndicatorGrid:`${z.nextStopIndicatorGrid} ${i?"bg-[#FF0000] text-white":"bg-[#FFFF00] text-black"}`,driverInfoGrid:`${z.driverInfoGrid} ${i?"bg-[#FF0000]":"bg-black"}`};return t.jsxs("div",{ref:r,className:m.parentGrid,children:[t.jsxs("div",{className:m.nextStopIndicatorGrid,children:[t.jsxs("div",{className:m.nextStopIndicatorZh,children:["下一站",i&&"停於"]}),t.jsxs("div",{className:m.nextStopIndicatorEn,children:["Next ",i?"Stopping at":"Stop"]})]}),t.jsx("div",{className:m.routeHeadingGrid,children:t.jsx(Dt,{})}),t.jsx("div",{className:m.stopProgressBarGrid,children:a?t.jsx(sr,{}):((T=n==null?void 0:n.stops)==null?void 0:T.length)>0&&t.jsxs("div",{className:m.stopProgressBarContainer,children:[t.jsx(Jt,{progressBarRef:h}),t.jsx(Zt,{progressBarRef:b})]})}),t.jsx("div",{className:m.dividerGrid}),t.jsx("div",{className:m.stopNameGrid,children:o?t.jsx(ve,{zhNameOverrideStyle:m.noticeZhOverrideStyle,enNameOverrideStyle:m.noticeEnOverrideStyle}):c?t.jsx(Ne,{zhNameOverrideStyle:m.noticeZhOverrideStyle,enNameOverrideStyle:m.noticeEnOverrideStyle}):t.jsxs(t.Fragment,{children:[t.jsx("span",{ref:f,className:m.stopNameZh,style:{fontSize:At(p)},children:p}),t.jsx("span",{ref:g,className:m.stopNameEn,children:x})]})}),t.jsxs("div",{className:m.driverInfoGrid,children:[t.jsxs("span",{className:m.driverInfoText,children:[l==null?void 0:l.nameZh,"車長正為您服務   Bus Captain "]}),t.jsxs("span",{className:`${m.driverInfoText} ${m.capitalize}`,children:[l==null?void 0:l.nameEn," "]}),t.jsxs("span",{className:m.driverInfoText,children:["is serving you   員工編號  Staff No.: ",l==null?void 0:l.staffNo]})]})]})},k={routeMarkerContainer:["flex flex-col","basis-[10%]","text-center","items-center"].join(" "),routeMarkerZh:["font-[500]","tracking-tighter","text-[4cqw]","max-sm:text-[4cqw]"].join(" "),routeMarkerEn:["tracking-tighter","text-[2.75cqw]","max-sm:text-[3cqw]"].join(" "),routeNumber:["basis-[17.5%]","font-[500]","text-[6.75cqw]","text-center","tracking-tight","scale-y-110"].join(" "),arrowContainer:["flex","basis-[10%]","max-xl:basis-[3.25rem]","max-sm:basis-[2rem]","justify-center"].join(" "),destContainer:["flex flex-col","mr-0.5"].join(" "),destZh:["font-[500]","whitespace-nowrap","text-[4.375cqw]","max-md:text-[4.375cqw]","max-sm:text-[5cqw]","tracking-wide","max-sm:tracking-normal"].join(" "),destEn:["font-[500]","text-sm","whitespace-nowrap","text-[2.5cqw]","max-sm:text-[2.625cqw]"].join(" ")},Dt=()=>{var n,s,a,o;const{routeDetail:e,lastStopIndex:r}=S(c=>c.routeSelection);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:k.routeMarkerContainer,children:[t.jsx("div",{className:k.routeMarkerZh,children:"路線"}),t.jsx("div",{className:k.routeMarkerEn,children:"Route"})]}),t.jsx("div",{className:k.routeNumber,children:e.route}),t.jsx("div",{className:k.arrowContainer,children:t.jsx(ar,{})}),t.jsxs("div",{className:k.destContainer,children:[t.jsx("div",{className:k.destZh,children:(s=(n=e==null?void 0:e.stops)==null?void 0:n[r])==null?void 0:s.zh}),t.jsx("div",{className:k.destEn,children:(o=(a=e==null?void 0:e.stops)==null?void 0:a[r])==null?void 0:o.en})]})]})},Gt=750,w={refContainer:"compact-progress-bar h-full",stopNameContainer:"stop-name-container @container w-full h-full relative",stopInfoRow:"stopInfoRow flex gap-1 w-full relative top-[33%] mb-[12cqw] items-center justify-center",stopInfoCol:"stopInfoCol flex flex-col gap-0.5 basis-[33%] min-w-[0] h-full justify-center",stopZh:"relative text-[2.5cqw] w-full text-center flex items-center justify-center",stopZhCurrent:"font-bold",stopEn:"relative text-[1.5cqw] w-full text-center flex items-center justify-center",stopEnCurrent:"font-black",stopEnOther:"text-black",progressBar:["progress-bar","line","flex justify-around","bg-[#FF0000]","w-[87.5%] h-[1.5cqw]","relative top-[-7cqw]","z-0"].join(" "),bullet:["bullet","bg-white","translate-x-[2cqw]","w-[1.5cqw] h-[1.5cqw]","max-sm:w-[1.75cqw] max-sm:h-[1.75cqw]","border-[1px] border-solid rounded-[50%]","relative","z-1","shrink-0"].join(" "),bulletPulse:["bulletPulse","outline outline-[0.15cqw] outline-white","border-[0.15cqw] border-[#FF0000]","!bg-[#FFFF00]","scale-125"].join(" "),bulletSecond:"bulletSecond translate-x-[7cqw]",bulletThird:"bulletThird translate-x-[11cqw]",arrowContainer:"absolute -translate-x-[37.5cqw]",arrowFirst:["absolute left-0","w-[1.5cqw] h-[1.5cqw]","border-t-[0.25vw] border-r-[0.25vw]","border-t-white border-r-white","rotate-45"].join(" "),arrowSecond:["absolute left-[1.75cqw]","w-[1.5cqw] h-[1.5cqw]","border-t-[0.25vw] border-r-[0.25vw]","border-t-white border-r-white","rotate-45"].join(" "),arrowThird:["absolute left-[3.5cqw]","w-[1.5cqw] h-[1.5cqw]","border-t-[0.25vw] border-r-[0.25vw]","border-t-white border-r-white","rotate-45"].join(" "),endIndicator:"h-[1.75cqw] border-1 border-solid border-red-600 rounded-[1px]",endIndicatorContainer:["absolute right-[-4%] top-1/2","-translate-y-1/2","flex gap-[1px]","z-10"].join(" ")},Zt=({progressBarRef:e})=>{const{routeDetail:r,currentStopIndex:n}=S(c=>c.routeSelection),[s,a]=u.useState(0),o=u.useRef(null);return u.useEffect(()=>(a(0),o.current&&clearInterval(o.current),o.current=setInterval(()=>{a(c=>c<3?c+1:0)},Gt),()=>clearInterval(o.current)),[n]),t.jsxs("div",{className:w.refContainer,ref:e,children:[t.jsx("div",{className:w.stopNameContainer,children:t.jsx("div",{className:w.stopInfoRow,children:[0,1,2].map(c=>{var l;const i=(l=r==null?void 0:r.stops)==null?void 0:l[n+c];return t.jsxs("div",{className:w.stopInfoCol,children:[t.jsx("div",{className:[w.stopZh,c===0&&w.stopZhCurrent].filter(Boolean).join(" "),children:i==null?void 0:i.zh}),t.jsx("div",{className:[w.stopEn,c===0?w.stopEnCurrent:w.stopEnOther].filter(Boolean).join(" "),children:i==null?void 0:i.en})]},c)})})}),t.jsxs("div",{className:w.progressBar,children:[t.jsxs("div",{className:w.arrowContainer,children:[s>=1&&t.jsx("div",{className:w.arrowFirst}),s>=2&&t.jsx("div",{className:w.arrowSecond}),s>=3&&t.jsx("div",{className:w.arrowThird})]}),[0,1,2].map(c=>t.jsx("div",{className:[w.bullet,c===0?w.bulletPulse:c===1?w.bulletSecond:w.bulletThird].filter(Boolean).join(" ")},c)),t.jsxs("div",{className:w.endIndicatorContainer,children:[t.jsx("div",{className:`${w.endIndicator} w-[0.25vw]`}),t.jsx("div",{className:`${w.endIndicator} w-[0.375vw]`}),t.jsx("div",{className:`${w.endIndicator} w-[0.5vw]`})]})]})]})},Kt=32,v={refContainer:"h-full",container:["line-container","@container flex","relative top-[87.5%]","w-[95%] h-[92%]","max-md:top-[89%]"].join(" "),startLineContainer:"flex gap-[2px] z-1",endLineContainer:["flex gap-[2px] justify-end","relative","w-full","max-md:gap-[0.5px]"].join(" "),progressBar:["@container line","flex flex-row justify-evenly","absolute left-1.5","w-[98%] h-[1.5cqw]","max-sm:w-[97%]","z-0"].join(" "),bullet:["bullet relative","bg-white border border-solid rounded-full","w-[1.5cqw] h-[1.5cqw]","z-1 shrink-0"].join(" "),bulletPulse:["animate-bullet-pulse","w-full h-full","rounded-[50%] bg-white"].join(" "),startLineBar:["bg-[gray]","w-[.2cqw] h-[2.5cqw]","max-md:w-[.375cqw] max-md:h-[3.5cqw]"].join(" "),endLineBar:["bg-[#FF0000]","w-[.2cqw] h-[2.5cqw]","max-md:w-[.375cqw] max-mx:h-[3.5cqw]"].join(" "),stopName:["stop-name absolute","text-black text-[1.75cqw]","top-[-2.75cqw] left-1/2","-translate-x-[5%] -rotate-[65deg]","origin-left whitespace-nowrap","max-md:text-[2cqw] max-md:top-[-3cqw]"].join(" "),stopNameCurrent:["font-black"].join(" "),stopNamePast:["!text-gray-300"].join(" "),splitEllipsis:["absolute text-xl","top-[-7cqw] right-[-3cqw]"].join(" ")},Ut=({stop:e,i:r,currentStopIndex:n})=>{const s=r===n,a=r<n;return t.jsxs("div",{className:v.bullet,style:{position:"relative"},children:[s&&t.jsx("div",{className:v.bulletPulse}),t.jsx("div",{className:[v.stopName,s&&v.stopNameCurrent,a&&v.stopNamePast].filter(Boolean).join(" "),children:e.zh})]})},Jt=({progressBarRef:e})=>{var f,g;const{routeDetail:r,currentStopIndex:n,isUserSelectedRoute:s}=S(m=>m.routeSelection),a=((f=r==null?void 0:r.stops)==null?void 0:f.length)??0,o=Kt,c=Math.floor(o*.8),[i,l]=Ct(a,n,o,c),p=l-i,x=n-i,h=p>1?x/(p+1)*100:0,b=a>o&&l<a;return t.jsx("div",{className:v.refContainer,ref:e,children:t.jsxs("div",{className:v.container,children:[s&&i===0&&t.jsx("div",{className:v.startLineContainer,children:[...Array(2)].map((m,d)=>t.jsx("div",{className:v.startLineBar},d))}),t.jsxs("div",{style:{background:`linear-gradient(to right, gray 0%, gray ${h}%, red ${h}%)`},className:v.progressBar,children:[(g=r==null?void 0:r.stops)==null?void 0:g.slice(i,l).map((m,d)=>t.jsx(Ut,{stop:m,i:i+d,currentStopIndex:n},i+d)),b&&t.jsx("div",{className:v.splitEllipsis,children:"..."})]}),s&&l===a&&t.jsx("div",{className:v.endLineContainer,children:[...Array(2)].map((m,d)=>t.jsx("div",{className:v.endLineBar},d))})]})})},O={parentGrid:["select-none","grid","grid-cols-[10fr_90fr]","grid-rows-[3.25fr_0.025fr_2fr_0.025fr_2fr]"].join(" "),arrowContainer:"@container text-center bg-[#FF0000]",arrowIcon:"mt-[0.5rem] justify-center",currentStopContainer:"flex flex-col bg-white"},Vt=({monitorStyle:e,screenTarget:r})=>{var l,p;const{routeDetail:n,currentStopIndex:s}=S(x=>x.routeSelection),{showMindDoorNotice:a,showHandrailNotice:o}=S(x=>x.userPreference),c=n==null?void 0:n.stops,i=[1,2].map(x=>{var h,b;return t.jsx(Qt,{stopZh:(h=c==null?void 0:c[s+x])==null?void 0:h.zh,stopEn:(b=c==null?void 0:c[s+x])==null?void 0:b.en},x)});return t.jsxs("div",{ref:r,className:`${O.parentGrid} ${e}`,children:[a?t.jsx(Ne,{}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:O.arrowContainer,children:t.jsx("div",{className:O.arrowIcon,children:t.jsx(Xt,{})})}),t.jsx("div",{className:O.currentStopContainer,children:t.jsx(Yt,{stopZh:(l=c==null?void 0:c[s])==null?void 0:l.zh,stopEn:(p=c==null?void 0:c[s])==null?void 0:p.en})})]}),o?t.jsx(ve,{}):t.jsx(t.Fragment,{children:i})]})},Xt=e=>t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",shapeRendering:"geometricPrecision",textRendering:"geometricPrecision",viewBox:"0 0 160 300",...e,children:[t.jsxs("g",{fill:"#3f5787",stroke:"#fbfbfb",strokeWidth:3,children:[t.jsx("path",{d:"M-96 0H4",transform:"matrix(.64952 .375 -3.75 6.4952 82.563 45.202)"}),t.jsx("path",{d:"M-96 0H4",transform:"matrix(.64952 -.375 3.75 6.4952 136.34 10.702)"}),t.jsx("path",{d:"M-96 0H4",transform:"matrix(.64952 .375 -3.75 6.4952 82.563 91.702)"}),t.jsx("path",{d:"M-96 0H4",transform:"matrix(.64952 -.375 3.75 6.4952 136.34 57.202)"}),t.jsx("path",{d:"M-96 0H4",transform:"matrix(.64952 .375 -3.75 6.4952 82.563 138.202)"}),t.jsx("path",{d:"M-96 0H4",transform:"matrix(.64952 -.375 3.75 6.4952 136.34 103.702)"})]}),t.jsxs("g",{transform:"matrix(.75 0 0 .75 -16.586 -9.692)",children:[t.jsx("ellipse",{fill:"#fff",rx:66.997,ry:67.383,transform:"matrix(1.32296 0 0 1.29333 128.995 324.173)"}),t.jsx("ellipse",{fill:"#fffa00",stroke:"red",strokeWidth:10,rx:66.997,ry:67.383,transform:"matrix(.94385 0 0 .93055 128.995 322.985)"})]})]}),L={container:["@container","font-[500]","relative left-[1.25%]","w-[95%]","h-full","tracking-[-0.0625rem]"].join(" "),zhStopName:["h-[12cqw]","relative top-[2cqw]","flex items-center","tracking-normal"].join(" "),enStopNameWrapper:["relative top-[15%]","flex","h-[33%]","w-full","leading-tight"].join(" "),enStopName:["text-[5.125cqw]","max-md:text-[5.5cqw]","leading-[1.2]","w-full"].join(" ")},ae=(e="",r="en")=>{if(!e)return{};const n=V(e),a={en:{},zh:{min:7,base:20,scale:.66,fallback:7,max:12.5}}[r];if(!a)return{};const o={fontSize:`clamp(${a.min}cqw, ${Math.max(a.base-n*a.scale,a.fallback)}cqw, ${a.max}cqw)`};if(r==="zh")o.marginTop=`${n*.025}cqh`;else if(r==="en"){const c=n>38;o.alignSelf=c?"flex-start":"center",c&&(o.lineHeight="1.3",o.marginTop="-.5rem")}return o},Yt=({stopZh:e="",stopEn:r=""})=>t.jsxs("div",{className:L.container,children:[t.jsx("div",{className:L.zhStopName,style:ae(e,"zh"),children:e}),t.jsx("div",{className:L.enStopNameWrapper,children:t.jsx("span",{className:L.enStopName,style:ae(r,"en"),children:r})})]}),R={divider:["col-start-1","col-end-5","bg-[#f7f6f6c5]"].join(" "),stopIndicatorContainer:["@container","flex flex-col justify-center items-center","bg-[#FF0000]"].join(" "),stopIndicator:["inline-block","rounded-[50%]","bg-white","w-[65cqw] h-[65cqw]"].join(" "),stopNameContainer:["@container","relative","flex flex-col","bg-white","tracking-[-0.0375rem]"].join(" "),stopNameContent:["@container","font-[500]","relative left-[1.25%]","flex flex-col justify-center","h-[92.5%]","whitespace-nowrap"].join(" "),zhStopName:["relative","justify-center","max-md:top-[0.25cqw]","tracking-normal"].join(" "),enStopName:["justify-center","text-[3.75cqw]","max-sm:text-[3.75cqw]","sm:max-md:text-[3.75cqw]"].join(" ")},ie=(e,r,n)=>e?{zh:{fontSize:`clamp(6.8cqw, ${Math.max(18-V(e)*.5,6.75)}cqw, 8.25cqw)`},en:(()=>{const a=e.length;if(a<45)return{};const o=n<768?4:n<1280?3.75:3.5,c=a>=50?.8:.85;return{fontSize:`${o*c}cqw`}})()}[r]||{}:{},Qt=({stopZh:e="",stopEn:r=""})=>{const{windowSize:n}=E();return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:R.divider}),t.jsx("div",{className:R.stopIndicatorContainer,children:t.jsx("div",{className:R.stopIndicator})}),t.jsx("div",{className:R.stopNameContainer,children:t.jsxs("div",{className:R.stopNameContent,children:[t.jsx("div",{className:R.zhStopName,style:ie(e,"zh"),children:e}),t.jsx("span",{className:R.enStopName,style:ie(r,"en",n),children:r})]})})]})},ve=({containerOverrideStyle:e="",zhNameOverrideStyle:r="",enNameOverrideStyle:n=""})=>{const s={noticeContainer:"@container w-full h-full row-span-99 col-span-2 flex flex-col items-center justify-center bg-amber-300",textZh:"text-[12cqw] mt-[-1cqw] tracking-wider font-[700]",textEn:"text-[5.5cqw] mt-[-1.5cqw] tracking-tight font-[700]"};return t.jsxs("div",{className:s.noticeContainer+" "+e,children:[t.jsx("div",{className:s.textZh+" "+r,children:"請緊握扶手"}),t.jsx("div",{className:s.textEn+" "+n,children:"Please hold the handrail"})]})},Ne=({containerOverrideStyle:e="",zhNameOverrideStyle:r="",enNameOverrideStyle:n=""})=>{const s={noticeContainer:"@container w-full h-full flex flex-col gap-1 col-span-3 justify-center items-center text-center bg-[#FF0000]",textZh:"text-[10cqw] mt-[-1cqw] text-white font-[600]",textEn:"text-[5cqw] mt-[-1.5cqw] text-white font-[600]"};return t.jsxs("div",{className:s.noticeContainer+" "+e,children:[t.jsx("div",{className:s.textZh+" "+r,children:"車門正在關上"}),t.jsx("div",{className:s.textEn+" "+n,children:"Door Closing"})]})},er=()=>t.jsx("div",{className:"fixed inset-0 -z-10 bg-gradient-to-br from-[#32302c] via-[#32323f] to-[#212525]",children:t.jsx("svg",{width:"100%",height:"100%",className:"absolute inset-0 pointer-events-none",style:{minHeight:"100vh"}})});j.string,j.string.isRequired,j.bool,j.func.isRequired;const tr=({error:e})=>t.jsx("div",{className:"flex items-center justify-center p-4 w-full",children:t.jsxs("div",{className:"flex items-center gap-4 bg-red-50 border-l-12 border-red-500 p-4 rounded-r shadow-lg max-w-2xl",children:[t.jsx(We,{className:"text-red-500 text-3xl"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-red-600",children:e||"An unexpected error occurred. Please try again."}),t.jsx("button",{onClick:()=>window.location.reload(),className:"mt-3 text-sm text-red-700 hover:cursor-pointer hover:text-red-900 underline",children:"Refresh Page"})]})]})}),rr=ue(pe)(({theme:e})=>({width:"100%",padding:e.spacing(2)})),nr=ue(W)(({theme:e})=>({fontSize:"0.75rem",color:"rgba(255,255,255, 0.5)",textAlign:"center",[e.breakpoints.down("sm")]:{fontSize:"0.75rem"}})),or=()=>t.jsx(rr,{component:"footer",children:t.jsx(Ae,{maxWidth:"xl",children:t.jsx("div",{className:"select-none max-md:hidden flex items-center justify-center",children:t.jsx(nr,{variant:"body2",component:"div",children:t.jsx("a",{target:"_blank",rel:"noreferrer",className:"text-gray-400/80 underline",href:"https://github.com/silverfankw/kmb-dpip",children:"silverfankw/kmb-dpip-v2 @ 2025"})})})})}),ke=({message:e="",style:r={},tailwindStyle:n=""})=>t.jsx("span",{style:r,className:`text-xs ${n}`,children:e});ke.propTypes={message:j.string.isRequired,style:j.object,tailwindStyle:j.string};const A=({id:e,type:r="text",pattern:n,validInput:s=!0,invalidMessage:a="",value:o="",style:c="",placeholder:i="",minLength:l,maxLength:p,onChange:x,onInput:h})=>t.jsxs("div",{children:[i&&t.jsx("label",{htmlFor:e,className:"text-xs text-gray-200",children:i}),t.jsx("input",{id:e,type:r,value:o,pattern:n,minLength:l,maxLength:p,className:`block bg-white text-black text-xs w-full 
                    rounded-lg border border-gray-500 py-3 pl-3 pr-10 
                    placeholder:text-gray-400 placeholder:text-xs
                    ${c}`,onChange:b=>x==null?void 0:x(b.target.value),onInput:h}),a&&!s&&o.length>0&&t.jsx(ke,{message:a,tailwindStyle:"text-red-600"})]});A.propTypes={id:j.string,type:j.string,pattern:j.string,validInput:j.bool,invalidMessage:j.string,value:j.string,style:j.string,placeholder:j.string,minLength:j.number,maxLength:j.number,onChange:j.func,onInput:j.func,submitAction:j.func};const sr=()=>t.jsx(pe,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:t.jsx(He,{color:"primary"})}),K=({sx:e,control:r,label:n})=>t.jsx(De,{sx:e,control:r,label:n}),ar=e=>t.jsx("svg",{width:"100%",height:"100%",style:{display:"block",maxWidth:"200px",height:"auto"},xmlns:"http://www.w3.org/2000/svg",shapeRendering:"geometricPrecision",textRendering:"geometricPrecision",viewBox:"0 0 200 130",...e,children:t.jsxs("g",{fill:"#fff",children:[t.jsxs("g",{transform:"translate(-714.021 -20.258)",children:[t.jsx("rect",{width:100.287,height:40.115,rx:0,ry:0,transform:"matrix(.48535 -.48535 .62202 0 727.59 131.579)"}),t.jsx("rect",{width:100.287,height:40.115,rx:0,ry:0,transform:"matrix(.49848 .49848 -.62202 0 751.225 32.957)"})]}),t.jsxs("g",{transform:"translate(-664.073 -19.578)",children:[t.jsx("rect",{width:100.287,height:40.115,rx:0,ry:0,transform:"matrix(.48535 -.48535 .62202 0 727.59 131.579)"}),t.jsx("rect",{width:100.287,height:40.115,rx:0,ry:0,transform:"matrix(.49848 .49848 -.62202 0 751.225 32.957)"})]}),t.jsxs("g",{transform:"translate(-613.467 -18.898)",children:[t.jsx("rect",{width:100.287,height:40.115,rx:0,ry:0,transform:"matrix(.48535 -.48535 .62202 0 727.59 131.579)"}),t.jsx("rect",{width:100.287,height:40.115,rx:0,ry:0,transform:"matrix(.49848 .49848 -.62202 0 751.225 32.957)"})]})]})}),C={rootContainer:"min-h-screen flex flex-col items-center",contentContainer:["select-none focus:outline-hidden","p-[2rem] max-sm:p-2","flex flex-1 flex-col gap-3 ","max-sm:gap-2"].join(" "),querySection:["order-1 max-sm:order-2","flex gap-3 items-center justify-center","bg-[#18181b]/80 backdrop-blur-md shadow-2xl ","p-6 max-md:p-4 max-md:flex-col max-md:gap-2","border border-gray-600/90 rounded-2xl"].join(" "),controlPanelSection:["order-2 max-sm:order-3","flex gap-4 flex-wrap justify-center","bg-[#18181b]/80 shadow-lg","p-6 w-full max-md:flex-col max-md:gap-4","border border-gray-600/90 rounded-2xl"].join(" "),screenPanelSection:["order-3 max-sm:order-1","flex flex-wrap items-center justify-center","gap-10 max-sm:gap-6 py-4"].join(" "),asyncSelectWrapper:"flex items-center gap-4 w-full",monitorStyle:["w-[800px] h-[480px]","max-xl:w-[700px] max-xl:h-[420px]","max-md:w-[600px] max-md:h-[360px]","max-sm:w-[400px] max-sm:h-[240px]","shadow-[0.5rem_0.5rem_1rem_0.25rem_#23272f]","border-[.375rem] max-md:border-[.25em] border-solid border-[#23272f]","rounded-xl","outline outline-[0.875rem] max-sm:outline-[0.625rem] outline-[#000000]","z-1"].join(" ")},ir=()=>{const e=de(),r=B();u.useEffect(()=>{r(at())},[r]);const{hasStoredData:n,storedData:s,saveToLocalStorage:a}=It(),{isUserSelectedRoute:o,loadingError:c,routeDetail:i,currentStopIndex:l}=S(f=>f.routeSelection),{routes:p}=S(f=>f.route),x=u.useCallback(async()=>{if(s&&p.length>0)try{r(Y({routeDetail:s,routes:p})),r(U(s.currentStopIndex||0))}catch(f){console.error("Error restoring selection:",f)}},[r,s,p]);u.useEffect(()=>{n&&p.length>0&&x()},[n,p,x]),u.useEffect(()=>{var f,g;if(o&&i&&Object.keys(i).length>0){const m={route:i.route,bound:i.bound,service_type:i.service_type,orig_tc:i.orig_tc,orig_en:i.orig_en,dest_tc:i.dest_tc,dest_en:i.dest_en,specialRemark:i.specialRemark,currentStop_tc:((f=i.stops[l])==null?void 0:f.zh)||"",currentStop_en:((g=i.stops[l])==null?void 0:g.en)||"",currentStopIndex:l,timestamp:Date.now()};a(m)}},[o,i,l,a]),u.useEffect(()=>{const f=()=>{var g,m;if(o&&i&&Object.keys(i).length>0){const d={route:i.route,bound:i.bound,service_type:i.service_type,orig_tc:i.orig_tc,orig_en:i.orig_en,dest_tc:i.dest_tc,dest_en:i.dest_en,specialRemark:i.specialRemark,currentStop_tc:((g=i.stops[l])==null?void 0:g.zh)||"",currentStop_en:((m=i.stops[l])==null?void 0:m.en)||"",currentStopIndex:l,timestamp:Date.now()};a(d)}};return window.addEventListener("beforeunload",f),()=>window.removeEventListener("beforeunload",f)},[o,i,l,a]);const h=u.useRef(null),b=u.useRef(null);return kt({onPrev:()=>r(be()),onNext:()=>r(je()),onHome:()=>r(U(0)),onEnd:()=>r(ge()),isUserSelectedRoute:o,debounceMs:100,isDisabled:!1}),t.jsxs(t.Fragment,{children:[t.jsx(er,{}),t.jsxs("div",{className:C.rootContainer,children:[t.jsxs("div",{className:C.contentContainer,tabIndex:1,children:[t.jsx("section",{className:C.querySection,children:t.jsxs("div",{className:C.asyncSelectWrapper,children:[t.jsx(Ge,{sx:{color:"#999",fontSize:24,[e.breakpoints.down("sm")]:{display:"none"}}}),t.jsx("div",{className:"flex-1",children:t.jsx(Pt,{})})]})}),t.jsx("section",{className:C.controlPanelSection,children:t.jsx(vt,{mainScreenTarget:h,secScreenTarget:b})}),t.jsx("section",{className:C.screenPanelSection,children:c?t.jsx(tr,{error:c}):t.jsxs(t.Fragment,{children:[t.jsx(Ht,{monitorStyle:C.monitorStyle,screenTarget:h}),t.jsx(Vt,{monitorStyle:C.monitorStyle,screenTarget:b})]})})]}),t.jsx(or,{})]})]})};Ce.createRoot(document.getElementById("root")).render(t.jsx(Fe,{store:yt,children:t.jsx(Ie,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:t.jsx(Ze,{theme:St,children:t.jsx(ir,{})})})}));
