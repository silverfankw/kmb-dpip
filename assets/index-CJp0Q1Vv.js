import{j as t,r as p,c as ie}from"./react-DLwQdj7q.js";import{a as Re}from"./react-dom-Bpij0FWw.js";import{B as Ee}from"./react-router-dom-Bjp-w-kY.js";import{u as w,a as B,P as Me}from"./react-redux-BsdHwLJa.js";import{c as U,a as ce,b as Pe}from"./@reduxjs-NaPybp_z.js";import{c as $e,u as le,a as Be,T as M,B as P,b as Te,F as ze,N as Oe,d as W,S as Z,H as Le,D as We,A as _e,e as Ae,C as He,R as Ze,E as Ge,s as de,f as pe,g as De,h as Ke,i as Ue,j as Ve,k as Je}from"./@mui-gEQS-3Z-.js";import{d as ue}from"./lodash-D9Xc9Uuo.js";import{c as X,A as Xe}from"./react-select-Cfw0BZ38.js";import{P as f}from"./prop-types-D7IYfoA1.js";import{s as V}from"./string-width-BwHzav8R.js";import"./@babel-3BxVu_ax.js";import"./scheduler-SPyfQU6S.js";import"./react-router-CV6FO8-_.js";import"./@remix-run-BBWqMfS0.js";import"./use-sync-external-store-BCKmAaC2.js";import"./redux-BXkGT1VS.js";import"./immer-DqxjFn0G.js";import"./redux-thunk-ClJT1hhx.js";import"./@emotion-_JA2SG62.js";import"./hoist-non-react-statics-C-Qo8PK8.js";import"./stylis-DDa9OTMq.js";import"./clsx-B-dksMZM.js";import"./react-transition-group-CndzbEAZ.js";import"./@popperjs-CMBiYTiD.js";import"./react-is-BPJnJB5S.js";import"./@floating-ui-Dqirgmo9.js";import"./use-isomorphic-layout-effect-8A7Cpl8G.js";import"./memoize-one-BdPwpGay.js";import"./get-east-asian-width-R4ibU9pT.js";import"./emoji-regex-D90yNSKR.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();const Ye=/\([A-Z]{2}\d{3}\)$/,Y=e=>e.replace(Ye,"").trim(),Qe=e=>{const r=e.data.name_en,n=e.data.name_tc;return{en:Y(r),zh:Y(n)}},et=(e,r="number")=>{var o;return e&&(((o={number:{O:"1",I:"2"},letter:{1:"O",2:"I"}}[r])==null?void 0:o[e])||e)},tt=e=>e&&String(parseInt(e,10)),$="｜",J="往",xe="特別班",rt="Desc_CHI",G=new Map;async function nt(){const e=await fetch("https://data.etabus.gov.hk/v1/transport/kmb/route/");if(!e.ok)throw new Error(`HTTP error! status: ${e.status} ${e.statusText}`);return(await e.json()).data}async function ot(e,r,n){return(await(await fetch(`https://data.etabus.gov.hk/v1/transport/kmb/route-stop/${e}/${r}/${n}`)).json()).data.map(s=>s.stop)}async function st(e){if(G.has(e))return G.get(e);try{const r=await fetch(`https://data.etabus.gov.hk/v1/transport/kmb/stop/${e}`);if(!r.ok)throw new Error(`HTTP error! status: ${r.status} ${r.statusText}`);const n=await r.json(),o=Qe(n);return G.set(e,o),o}catch(r){throw console.error(`Error when fetching stop detail for stopID: ${e}`,r),r}}async function at(e){return Promise.all(e.map(st))}async function it(e,r,n){var c,d;const o=et(r,"number"),a=await fetch(`https://search.kmb.hk/KMBWebSite/Function/FunctionRequest.ashx?action=getSpecialRoute&route=${e}&bound=${o}`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status} ${a.statusText}`);const i=(d=(c=(await a.json()).data)==null?void 0:c.routes)==null?void 0:d.find(({Route:u,Bound:x,ServiceType:m})=>e===u&&o===x&&n===tt(m==null?void 0:m.trim()));return(i==null?void 0:i[rt])??""}const ct={routes:[],isLoading:!1,error:null},lt=()=>async e=>{e(Q(!0));try{const r=await nt(),n=new Map(r.map(s=>[`${s.route}-${s.bound}-${s.service_type}`,s])),o=r.filter(s=>s.service_type!=="1").map(async s=>{const i=await it(s.route,s.bound,s.service_type),c=`${s.route}-${s.bound}-${s.service_type}`;n.set(c,{...s,specialRemark:i})});await Promise.all(o);const a=Array.from(n.values());localStorage.setItem("routes",JSON.stringify(a)),e(he(a))}catch(r){console.error("Error fetching routes:",r),e(pt(r.message))}finally{e(Q(!1))}},dt=()=>async e=>{const r=localStorage.getItem("routes");if(r){e(he(JSON.parse(r)));return}e(lt())},me=U({name:"route",initialState:ct,reducers:{setRoutes:(e,r)=>{e.routes=r.payload},setLoading:(e,r)=>{e.isLoading=r.payload},setError:(e,r)=>{e.error=r.payload}}}),{setRoutes:he,setLoading:Q,setError:pt}=me.actions,ut=me.reducer,xt={routeDetail:{},currentStopIndex:0,lastStopIndex:0,isUserSelectedRoute:!1,routeHasTwoBound:!1,isLoading:!1,loadingError:null},mt=e=>e.routeSelection.currentStopIndex>0,ht=e=>e.routeSelection.currentStopIndex<e.routeSelection.lastStopIndex,fe=ce("routeSelection/selectRoute",async({routeDetail:e,routes:r},{dispatch:n})=>{n(ee(!0)),n(te(null));try{const{route:o,bound:a,service_type:s,orig_tc:i,orig_en:c,dest_tc:d,dest_en:u,specialRemark:x}=e,m=r.some(l=>l.bound==="I"&&l.route===o)&&r.some(l=>l.bound==="O"&&l.route===o);n(bt(m));const b=a==="I"||a==="inbound"?"inbound":"outbound",j=await ot(o,b,s),y=await at(j);n(be(0)),n(ft({route:o,bound:b,stops:y,orig_tc:i,orig_en:c,dest_tc:d,dest_en:u,service_type:s,specialRemark:x})),n(wt(!0))}catch(o){n(te(o.message))}finally{n(ee(!1))}}),ge=ce("routeSelection/changeBound",async(e,{getState:r,dispatch:n})=>{const o=r().routeSelection,a=r().route.routes,{routeDetail:s,routeHasTwoBound:i,isUserSelectedRoute:c}=o;if(c&&(i||(s==null?void 0:s.service_type)===1)){const{bound:d}=s;n(fe({routeDetail:{...s,bound:d==="inbound"?"outbound":"inbound"},routes:a}))}}),we=U({name:"routeSelection",initialState:xt,reducers:{setRouteDetail(e,r){var n;e.routeDetail=r.payload,e.lastStopIndex=(((n=r.payload.stops)==null?void 0:n.length)??1)-1},setCurrentStopIndex(e,r){e.currentStopIndex=r.payload},toPrevStop(e){e.currentStopIndex>0&&(e.currentStopIndex-=1)},toNextStop(e){e.currentStopIndex<e.lastStopIndex&&(e.currentStopIndex+=1)},resetToFirstStop(e){e.currentStopIndex=0},setIsUserSelectedRoute(e,r){e.isUserSelectedRoute=r.payload},setRouteHasTwoBound(e,r){e.routeHasTwoBound=r.payload},setIsLoading:(e,r)=>{e.isLoading=r.payload},setLoadingError:(e,r)=>{e.loadingError=r.payload}}}),{setRouteDetail:ft,setCurrentStopIndex:be,toPrevStop:je,toNextStop:ye,resetToFirstStop:gt,setIsUserSelectedRoute:wt,setRouteHasTwoBound:bt,setIsLoading:ee,setLoadingError:te}=we.actions,jt=we.reducer,yt={stopPressed:!1,driverInfo:{nameZh:"九巴仔",nameEn:"KMB Boy",staffNo:"1933"},customizeDriverInfoToggle:!1,showMindDoorNotice:!1,showHandrailNotice:!1},Se=U({name:"userPreference",initialState:yt,reducers:{setStopPressed(e,r){e.stopPressed=r.payload},setDriverInfo(e,r){e.driverInfo={...e.driverInfo,...r.payload}},setCustomizeDriverInfoToggle(e,r){e.customizeDriverInfoToggle=r.payload},setShowMindDoorNotice(e,r){e.showMindDoorNotice=r.payload},setShowHandrailNotice(e,r){e.showHandrailNotice=r.payload},setShowHandrailAndMindDoorNotice(e,r){e.showHandrailNotice=r.payload.showHandrailNotice,e.showMindDoorNotice=r.payload.showMindDoorNotice}}}),{setStopPressed:St,setDriverInfo:D,setCustomizeDriverInfoToggle:vt,setShowMindDoorNotice:Or,setShowHandrailNotice:Lr,setShowHandrailAndMindDoorNotice:re}=Se.actions,Nt=Se.reducer,kt=Pe({reducer:{route:ut,routeSelection:jt,userPreference:Nt}}),Ct=$e({breakpoints:{values:{xs:480,sm:640,md:768,lg:1024,xl:1280,"2xl":1536,"3xl":1920}},typography:{fontFamily:"Noto Sans, sans-serif"},palette:{darkRed:{main:"#A81919",light:"#EF4444",dark:"#991212",contrastText:"#FFF1F2"},nextGreen:{main:"#089314",light:"#147738",dark:"#077F11",contrastText:"#FFFFFF"},directionPurple:{main:"#822093",light:"#B983D6",dark:"#701C7F",contrastText:"#F3E8FF"},ochre:{main:"#E3D026",light:"#FFF176",dark:"#C4B121",contrastText:"#262A33"},snowwhite:{main:"#FFFFFF"}}}),E={groupWrapper:"flex flex-wrap gap-4 max-md:gap-3 justify-center items-center w-full max-md:w-auto",divider:"block max-2xl:hidden w-px bg-gray-300 mx-2",driverInfoSection:"flex text-center items-center text-white gap-3"},It=({mainScreenTarget:e,secScreenTarget:r})=>{const n=w(o=>o.userPreference);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:E.groupWrapper,children:t.jsx(Lt,{})}),t.jsx("div",{className:E.divider}),t.jsx("div",{className:E.groupWrapper,children:t.jsx(Ot,{})}),t.jsx("div",{className:E.divider}),t.jsx("div",{className:E.groupWrapper,children:t.jsx(zt,{mainScreenTarget:e,secScreenTarget:r})}),n.customizeDriverInfoToggle&&t.jsx("section",{className:E.driverInfoSection,children:t.jsx(Ft,{})})]})},Ft=()=>{const{driverInfo:e}=w(n=>n.userPreference),r=B();return t.jsxs(t.Fragment,{children:[t.jsx(_,{placeholder:"車長中文姓氏 (最多2字)",maxLength:2,value:e==null?void 0:e.nameZh,defaultValue:e==null?void 0:e.nameZh,onChange:n=>{n==""&&(n="九巴仔"),r(D({nameZh:n}))}}),t.jsx(_,{style:"capitalize",placeholder:"車長英文姓氏 (最多10字)",maxLength:10,value:e==null?void 0:e.nameEn,defaultValue:e==null?void 0:e.nameEn,onChange:n=>{n==""&&(n="KMB Boy"),r(D({nameEn:n}))}}),t.jsx(_,{placeholder:"職員編號 (1位至6位數字)",type:"number",minLength:1,maxLength:6,value:e==null?void 0:e.staffNo,defaultValue:e==null?void 0:e.staffNo,onInput:n=>n.target.value=Math.abs(n.target.value.slice(0,6)),onChange:n=>{n==""&&(n="1933"),r(D({staffNo:n}))}})]})},qt=({onPrev:e,onNext:r,onHome:n,onEnd:o,isUserSelectedRoute:a=!0,debounceMs:s=50,isDisabled:i=!1})=>{const c=p.useRef(null),d=p.useCallback(u=>{if(!(c.current||i)){switch(u){case"ArrowLeft":e==null||e();break;case"ArrowRight":r==null||r();break;case"Home":n==null||n();break;case"End":o==null||o();break;default:return}c.current=setTimeout(()=>{c.current=null},s)}},[e,r,n,o,s,i]);p.useEffect(()=>{if(!a)return;const u=x=>d(x.key);return window.addEventListener("keydown",u),()=>{window.removeEventListener("keydown",u),c.current&&(clearTimeout(c.current),c.current=null)}},[d,a])},Rt=(e,r,n,o)=>p.useMemo(()=>e<=n?[0,e]:r<o?[0,n]:r>=e-n?[e-n,e]:[r-o+1,r-o+1+n],[e,r,n,o]),Et={regular:{},xhtEhc:{backgroundColor:"#CF0001"},marathon:{backgroundColor:"#CF0001"},whc:{backgroundColor:"#027233"},airport:{backgroundColor:"#0A2163",color:"#E3D026"},external:{backgroundColor:"#ff5000"},overnight:{backgroundColor:"#000000"},airportOvernight:{backgroundColor:"#000000",color:"#DED702"},premier:{backgroundColor:"#E5B034"},shuttle:{backgroundColor:"#EB5136",color:"#0E2775"},disneyRecreational:{backgroundColor:"#146FD1"},r8:{backgroundColor:"#72C8E5",color:"#1C2EB5"},awe:{backgroundColor:"#6F2F9F"}},Mt=[{type:"regular",regex:/^(331)[S]?/},{type:"xhtEhc",regex:/^[136]\d{2}[A-Z]?$/},{type:"whc",regex:/^9(?!17|18|45$)\d{2}[A-Z]?$/},{type:"overnight",regex:/^(N(?!A)[A-Z0-9]+|270S|271S|293S)$/i},{type:"airport",regex:/^A/},{type:"airportOvernight",regex:/^NA/},{type:"external",regex:/^E/},{type:"shuttle",regex:/^S(?!P)/},{type:"premier",regex:/^P96[08]$/},{type:"disneyRecreational",regex:/^R(33|42)$/i},{type:"r8",regex:/^R8$/i},{type:"marathon",regex:/^R(108|603|673|678|680|934|936|948|960|961|968)$/i},{type:"awe",regex:/^X(33|36|40|43|47)$/i}],Pt=()=>{const{isMobile:e}=I(),r=p.useMemo(()=>e?"mobile":"desktop",[e]),n=p.useMemo(()=>({display:"inline-block",textAlign:"center",color:"#FFFFFF",width:e?"42px":"52px",borderRadius:"2px",fontWeight:700}),[e]),o=p.useMemo(()=>({...Et,shared:n}),[n]),a=p.useMemo(()=>new Map,[]);return p.useMemo(()=>i=>{const c=`${i}-${r}`;if(a.has(c))return a.get(c);const d=Mt.find(x=>x.regex.test(i)),u={...o.shared,...o[(d==null?void 0:d.type)??"regular"]};return a.set(i,u),u},[o,a,r])},I=()=>{const[e,r]=p.useState({width:window.innerWidth,height:window.innerHeight,isMobile:window.innerWidth<=768}),n=p.useMemo(()=>ue(()=>{r({width:window.innerWidth,height:window.innerHeight,isMobile:window.innerWidth<=768})},150),[]);return p.useEffect(()=>(window.addEventListener("resize",n),()=>{n.cancel(),window.removeEventListener("resize",n)}),[n]),e},ne=(e,r,n,o=[])=>{p.useEffect(()=>{e.current&&r.current&&(e.current.style.display="block",r.current.style.display="none");const s=setInterval(()=>{if(e.current&&r.current){const i=e.current.style.display!=="none";e.current.style.display=i?"none":"block",r.current.style.display=i?"block":"none"}},n);return()=>clearInterval(s)},o)},ve={labelWrapper:{display:"flex",gap:"1.5px",alignItems:"center",fontSize:window.innerWidth<=768?"14px":"18px",fontWeight:500,minWidth:0},reactSelect:{control:(e,r)=>({...e,backgroundColor:"rgba(24, 27, 27, 0.5)",color:"#fff",borderColor:r.isFocused?"#2563eb":"#444",boxShadow:r.isFocused?"0 0 0 2px #2563eb":e.boxShadow,height:window.innerWidth<=768?36:42,minHeight:window.innerWidth<=768?36:42}),menu:e=>({...e,backgroundColor:"rgba(35, 39, 47, 0.85)",color:"#fff",zIndex:9999,fontSize:window.innerWidth<=768?"14px":e.fontSize}),placeholder:e=>({...e,color:"#777",opacity:1}),option:(e,r)=>({...e,backgroundColor:r.isFocused?"rgba(0, 0, 0, 1)":"rgba(32, 36, 38, 0.9)",color:"#fff"}),input:e=>({...e,color:"#fff"}),singleValue:e=>({...e,color:"#fff"}),indicatorSeparator:(e,r)=>({...e,backgroundColor:r.isFocused?"#2563eb":"#444"}),dropdownIndicator:(e,r)=>({...e,color:r.isFocused?"#00194f":"#444","&:hover":{color:"#999"}}),clearIndicator:(e,r)=>({...e,color:r.isFocused?"#2563eb":"#444","&:hover":{color:"#999"}})}},oe=e=>({label:`${e.route}${$} ${e.orig_tc} ${J} ${e.dest_tc} ${$}${e.service_type!=1?xe:""}${$}${e.specialRemark??""}`,value:`${e.route}-${e.bound}-${e.service_type}`,detail:e}),Ne=({componentType:e,data:r,...n})=>{const{isMobile:o}=I(),{label:a}=r,[s,i,c,d=""]=a.split($),[u,x]=i.split(J),m=e==="Option"?X.Option:X.SingleValue,b=p.useMemo(()=>({...ve.labelWrapper,fontSize:o?"14px":"18px",gap:o?"2px":"4px"}),[o]);return t.jsx(m,{...n,data:r,children:t.jsxs("div",{style:b,children:[t.jsx(Bt,{route:s,isSpecial:c==null?void 0:c.includes(xe),componentType:e,isMobile:o}),t.jsx(Tt,{origin:u,destination:x,remark:d})]})})},ke=ie.memo(e=>t.jsx(Ne,{...e,componentType:"Option"}));ke.displayName="MemoizedOption";const Ce=ie.memo(e=>t.jsx(Ne,{...e,componentType:"SingleValue"}));Ce.displayName="MemoizedSingleValue";const $t=()=>{const{isMobile:e}=I(),r=B(),{routes:n}=w(l=>l.route),[o,a]=p.useState(null),[s,i]=p.useState([]),c=p.useMemo(()=>{var l;return(l=n==null?void 0:n.slice(0,50))==null?void 0:l.map(oe)},[n]),d=p.useRef(new Map),[u,x]=p.useState(!1),m=p.useMemo(()=>ue((l,g)=>{const F=(l==null?void 0:l.toUpperCase())||"";if(d.current.has(F)){const v=d.current.get(F);i(v),g(v),x(!1);return}setTimeout(()=>{try{const v=l?n.filter(N=>N.route.toUpperCase().startsWith(F)):n.slice(0,50);((N=0)=>{const H=v.slice(N,N+50).map(oe);N===0&&(d.current.set(F,H),i(H),g(H),x(!1))})(0)}catch(v){console.error("Search error:",v),x(!1)}},0)},150),[n]);p.useEffect(()=>()=>{m.cancel(),d.current.clear()},[m]);const b=p.useCallback((l,g)=>{x(!0),m(l,g)},[m]),j=p.useCallback(l=>{l&&(r(fe({routeDetail:l.detail,routes:n})),a(l))},[r,n]),y=p.useMemo(()=>({...ve.reactSelect,control:(l,g)=>({...l,backgroundColor:"rgba(24, 27, 27, 0.5)",color:"#fff",borderColor:g.isFocused?"#2563eb":"#444",boxShadow:g.isFocused?"0 0 0 2px #2563eb":l.boxShadow,height:e?36:42,minHeight:e?36:42}),menu:l=>({...l,backgroundColor:"rgba(35, 39, 47, 0.85)",color:"#fff",zIndex:9999,fontSize:e?"14px":l.fontSize})}),[e]);return t.jsx(Xe,{components:{Option:ke,SingleValue:Ce},classNamePrefix:"routeInputSelect",menuPortalTarget:document.body,styles:y,autoFocus:!0,isClearable:!0,cacheOptions:!0,defaultOptions:s.length?s:c,placeholder:"輸入九巴路線編號　Input KMB route.",loadingMessage:()=>"搜尋路線中...",isLoading:u,filterOption:null,loadOptions:b,value:o,onChange:j})},Bt=({route:e,isSpecial:r,componentType:n})=>{const{isMobile:o}=I(),a=Pt(),s=p.useMemo(()=>({routeLabel:{display:n==="Option"?"inline-flex":"flex",flexDirection:n==="Option"?"column":"row",gap:n==="Option"?0:"4px",width:n==="Option"?o?"36px":"52px":"fit-content",alignItems:"center",justifyContent:"center",letterSpacing:"-0.25px",minWidth:o?"40px":"52px",position:"relative",transform:"scale(1, 1.1)"},specialTrip:{marginTop:"2px",fontSize:o?"10px":"12px",padding:o?"1px 4px":"2px 6px",border:"1px solid rgba(8, 28, 81, 1)",borderRadius:"4px",backgroundColor:"rgba(255, 214, 0, 0.75)",color:"#000",lineHeight:1.1,maxWidth:"100%",textAlign:"center"}}),[o,n]);return t.jsxs("div",{style:s.routeLabel,children:[t.jsx("span",{style:a(e),children:e}),r&&t.jsx("span",{style:s.specialTrip,children:"特別班"})]})},Tt=({origin:e,destination:r,remark:n})=>{const{isMobile:o}=I(),a=p.useMemo(()=>({wrapper:{display:"inline-flex",letterSpacing:o?"0":"0.25px",alignItems:"center",gap:o?"4px":"8px",minWidth:0,flexWrap:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},special:{fontSize:o?"12px":"15px",textAlign:"center",maxWidth:o?"120px":"none",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},to:{fontSize:o?"10px":"14px",marginTop:"1.5px",fontWeight:400}}),[o]);return t.jsxs(t.Fragment,{children:[t.jsx("span",{children:$}),t.jsxs("div",{style:a.wrapper,children:[e,t.jsx("span",{style:a.to,children:J}),r]}),t.jsx("span",{children:$}),n&&t.jsx("span",{style:a.special,children:n})]})},R=e=>{const r=le(),{isMobile:n}=I();return p.useMemo(()=>{var o;return{button:{backgroundColor:a=>{var s;return((s=a.palette[e])==null?void 0:s.main)||a.palette.primary.main},color:a=>{var s;return(s=a.palette[e])==null?void 0:s.contrastText},borderRadius:2,boxShadow:"0 2px 8px 0 rgba(0,0,0,0.10)",fontFamily:"Zen Kaku Gothic Antique",fontWeight:500,fontSize:n?"1.1rem":"1rem",height:n?"64px":"48px",px:3,py:1,textTransform:"none",transition:"all 0.2s ease-in-out",outline:"none","&:hover":{backgroundColor:a=>{var s;return((s=a.palette[e])==null?void 0:s.dark)||a.palette.primary.dark},boxShadow:"0 6px 24px 0 rgba(37,99,235,0.18)",filter:"brightness(1.08)",transform:"translateY(-2px) scale(1.04)",outline:`2.5px solid ${(o=r.palette[e])==null?void 0:o.dark}`,outlineOffset:"1px"},"&:focus-visible":{outline:"2.5px solid #2563eb",outlineOffset:"1px"},"&:active":{boxShadow:"0 1px 4px 0 rgba(0,0,0,0.12)",filter:"brightness(0.97)",transform:"scale(0.98)"},"&.Mui-disabled":{backgroundColor:"#2d2b2b !important",color:"#595555 !important",boxShadow:"none",opacity:1,border:"1px solid #2d2b2b",cursor:"not-allowed"}},label:{fontSize:n?"1.25rem":"1rem",whiteSpace:"nowrap",fontFamily:"Zen Kaku Gothic Antique",fontWeight:500},labelWrapper:{display:"flex",alignItems:"center",gap:6},switch:{"& .MuiSwitch-switchBase.Mui-checked":{color:a=>{var s;return((s=a.palette[e])==null?void 0:s.light)||a.palette.primary.light},"&:hover":{backgroundColor:a=>{var s;return Be(((s=a.palette[e])==null?void 0:s.light)||a.palette.primary.light,.08)}}},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:a=>{var s;return((s=a.palette[e])==null?void 0:s.dark)||a.palette.primary.dark},opacity:.75},transform:n?"scale(1.5)":"scale(1.1)"},switchLabel:{display:"flex",alignItems:"center",gap:n?2:1}}},[e,n,r])},zt=({mainScreenTarget:e,secScreenTarget:r})=>{const{isUserSelectedRoute:n}=w(c=>c.routeSelection),{customizeDriverInfoToggle:o}=w(c=>c.userPreference),a=B(),s=R("info"),i=[{key:"main",target:e,label:"主螢幕：全螢幕顯示"},{key:"sec",target:r,label:"輔螢幕：全螢幕顯示"}];return t.jsxs(t.Fragment,{children:[t.jsx(M,{arrow:!0,placement:"bottom-start",title:"自定義車長資料顯示",children:t.jsx("span",{children:t.jsx(P,{sx:s.button,color:"ochre",variant:"contained",startIcon:t.jsx(Te,{}),onClick:()=>{a(vt(!o))},children:t.jsx("span",{className:s.label,children:"更改車長資料"})})})}),i.map(({key:c,target:d,label:u})=>t.jsx(M,{className:s.fullscreenTooltip,arrow:!0,placement:"bottom-start",title:"選擇路線後才能開啟全螢幕顯示功能",children:t.jsx("span",{children:t.jsx(P,{sx:{...s.button,display:{xs:"none",md:"inline-block"}},color:"info",variant:"contained",disabled:!n,className:s.button,startIcon:t.jsx(ze,{}),onClick:()=>{d.current.requestFullscreen()},children:t.jsx("span",{children:u})})})},c))]})},Ot=()=>{const{stopPressed:e,showHandrailNotice:r,showMindDoorNotice:n}=w(i=>i.userPreference),o=B(),a=R("darkRed"),s=R("ochre");return t.jsxs(t.Fragment,{children:[t.jsx(K,{sx:a.button,control:t.jsx(Z,{checked:e,onChange:()=>o(St(!e)),name:"stop pressed",sx:a.switch}),label:t.jsxs("span",{style:a.labelWrapper,children:[t.jsx(Oe,{color:"snowwhite"}),t.jsx(W,{variant:"button",sx:a.label,children:e?"  解除":" 按鐘"})]})}),t.jsx(K,{sx:s.button,control:t.jsx(Z,{checked:r,color:"gold",onChange:()=>{o(re({showHandrailNotice:!r,showMindDoorNotice:n&&!1}))},name:"handrail notice",sx:s.switch}),label:t.jsxs("span",{style:s.labelWrapper,children:[t.jsx(Le,{}),t.jsx(W,{sx:s.label,variant:"button",children:"請緊握扶手"})]})}),t.jsx(K,{sx:s.button,control:t.jsx(Z,{checked:n,color:"gold",onChange:()=>{o(re({showMindDoorNotice:!n,showHandrailNotice:r&&!1}))},name:"mind door notice",sx:s.switch}),label:t.jsxs("span",{style:s.labelWrapper,children:[t.jsx(We,{}),t.jsx(W,{sx:s.label,variant:"button",children:"車門正在關上"})]})})]})},Lt=()=>{const e=B(),{currentStopIndex:r,isUserSelectedRoute:n,routeDetail:o,routeHasTwoBound:a}=w(m=>m.routeSelection),s=w(mt),i=w(ht),c=R("nextGreen"),d=R("darkRed"),u=R("ochre"),x=R("directionPurple");return t.jsxs(t.Fragment,{children:[t.jsx(M,{arrow:!0,placement:"bottom-start",title:"上一站 鍵盤快捷鍵: '←'",children:t.jsx("span",{children:t.jsx(P,{color:"darkRed",variant:"contained",sx:d.button,startIcon:t.jsx(_e,{}),onClick:()=>e(je()),disabled:!s,children:t.jsx("span",{className:d.buttonLabel,children:"上站"})})})}),t.jsx(M,{arrow:!0,placement:"bottom-start",title:"下一站 鍵盤快捷鍵: '→'",children:t.jsx("span",{children:t.jsx(P,{color:"nextGreen",variant:"contained",sx:c.button,startIcon:t.jsx(Ae,{}),onClick:()=>e(ye()),disabled:!i,children:t.jsx("span",{className:c.buttonLabel,children:"下站"})})})}),t.jsx(M,{arrow:!0,placement:"bottom-start",title:"切換路線方向 鍵盤快捷鍵: 'END'",children:t.jsx("span",{children:t.jsx(P,{color:"directionPurple",variant:"contained",sx:x.button,startIcon:t.jsx(He,{}),onClick:()=>e(ge()),disabled:!n||!a||(o==null?void 0:o.service_type)!=1,children:t.jsx("span",{className:x.buttonLabel,children:"方向"})})})}),t.jsx(M,{arrow:!0,placement:"bottom-start",title:"重設至首站 鍵盤快捷鍵: 'HOME'",children:t.jsx("span",{children:t.jsx(P,{className:u.button,color:"ochre",variant:"contained",startIcon:t.jsx(Ze,{}),sx:u.button,onClick:()=>e(gt()),disabled:!n||r==0,children:t.jsx("span",{className:u.buttonLabel,children:"首站"})})})})]})},Wt=11e3,_t=4500,z={parentGrid:["select-none","grid","grid-rows-[0.5fr_1.85fr_0.0375fr_1fr_0.125fr]"].join(" "),nextStopIndicatorGrid:["@container","col-start-1 col-end-2","flex flex-col items-center justify-center","text-center"].join(" "),nextStopIndicatorZh:["text-[15cqw]","mb-[-4px]","font-[600]","max-sm:text-[16cqw]"].join(" "),nextStopIndicatorEn:["text-[7.5cqw]","max-sm:text-[9cqw]","font-[400]"].join(" "),routeHeadingGrid:["@container","col-start-2 col-end-5","flex items-center gap-1","pl-0.5","bg-black text-white"].join(" "),stopProgressBarGrid:["@container","col-start-1 col-end-5","bg-white"].join(" "),stopProgressBarContainer:["h-full","font-[400]","text-center","tracking-tight"].join(" "),dividerGrid:["col-start-1 col-end-5","bg-black"].join(" "),stopNameGrid:["@container","col-start-1 col-end-5","bg-white","flex justify-center items-center"].join(" "),stopNameZh:["font-[500]","text-[8cqw]","max-sm:text-[8.5cqw]","max-md:text-[10cqw]","whitespace-nowrap overflow-hidden"].join(" "),stopNameEn:["text-center","font-[500]","text-[5cqw]","max-sm:text-[4cqw]","max-md:text-[5cqw]"].join(" "),driverInfoGrid:["@container","flex justify-center","col-start-1 col-end-5","font-[400]","text-white","p-1"].join(" "),driverInfoText:["text-[2cqw]","max-md:text-[2.25cqw]"].join(" "),capitalize:"capitalize",noticeZhOverrideStyle:"!text-[8cqw]",noticeEnOverrideStyle:"!text-[3.75cqw]"},At=e=>{const r=V(e||"");return`clamp(2rem, ${Math.max(16-r*.45,6.5)}cqw, 10cqw)`},Ht=({monitorStyle:e,screenTarget:r})=>{var g,F,v,A,N;const{routeDetail:n,currentStopIndex:o,isLoading:a}=w(T=>T.routeSelection),{showHandrailNotice:s,showMindDoorNotice:i,stopPressed:c,driverInfo:d}=w(T=>T.userPreference),u=(F=(g=n==null?void 0:n.stops)==null?void 0:g[o])==null?void 0:F.zh,x=(A=(v=n==null?void 0:n.stops)==null?void 0:v[o])==null?void 0:A.en,m=p.useRef(null),b=p.useRef(null),j=p.useRef(null),y=p.useRef(null);ne(m,b,Wt,[n==null?void 0:n.route,n==null?void 0:n.bound,n==null?void 0:n.service_type]),ne(j,y,_t,[n==null?void 0:n.route,n==null?void 0:n.bound,n==null?void 0:n.service_type]),p.useEffect(()=>{s||i?(j.current&&(j.current.style.display="none"),y.current&&(y.current.style.display="none")):(j.current&&(j.current.style.display="block"),y.current&&(y.current.style.display="none"))},[s,i]);const l={...z,parentGrid:`${z.parentGrid} ${e}`,nextStopIndicatorGrid:`${z.nextStopIndicatorGrid} ${c?"bg-[#FF0000] text-white":"bg-[#FFFF00] text-black"}`,driverInfoGrid:`${z.driverInfoGrid} ${c?"bg-[#FF0000]":"bg-black"}`};return t.jsxs("div",{ref:r,className:l.parentGrid,children:[t.jsxs("div",{className:l.nextStopIndicatorGrid,children:[t.jsxs("div",{className:l.nextStopIndicatorZh,children:["下一站",c&&"停於"]}),t.jsxs("div",{className:l.nextStopIndicatorEn,children:["Next ",c?"Stopping at":"Stop"]})]}),t.jsx("div",{className:l.routeHeadingGrid,children:t.jsx(Zt,{})}),t.jsx("div",{className:l.stopProgressBarGrid,children:a?t.jsx(sr,{}):((N=n==null?void 0:n.stops)==null?void 0:N.length)>0&&t.jsxs("div",{className:l.stopProgressBarContainer,children:[t.jsx(Vt,{progressBarRef:m}),t.jsx(Dt,{progressBarRef:b})]})}),t.jsx("div",{className:l.dividerGrid}),t.jsx("div",{className:l.stopNameGrid,children:s?t.jsx(Ie,{zhNameOverrideStyle:l.noticeZhOverrideStyle,enNameOverrideStyle:l.noticeEnOverrideStyle}):i?t.jsx(Fe,{zhNameOverrideStyle:l.noticeZhOverrideStyle,enNameOverrideStyle:l.noticeEnOverrideStyle}):t.jsxs(t.Fragment,{children:[t.jsx("span",{ref:j,className:l.stopNameZh,style:{fontSize:At(u)},children:u}),t.jsx("span",{ref:y,className:l.stopNameEn,children:x})]})}),t.jsxs("div",{className:l.driverInfoGrid,children:[t.jsxs("span",{className:l.driverInfoText,children:[d==null?void 0:d.nameZh,"車長正為您服務   Bus Captain "]}),t.jsxs("span",{className:`${l.driverInfoText} ${l.capitalize}`,children:[d==null?void 0:d.nameEn," "]}),t.jsxs("span",{className:l.driverInfoText,children:["is serving you   員工編號  Emp. No: ",d==null?void 0:d.staffNo]})]})]})},k={routeMarkerContainer:["flex flex-col","basis-[10%]","text-center","items-center"].join(" "),routeMarkerZh:["font-[500]","tracking-tighter","text-[4cqw]","max-sm:text-[4cqw]"].join(" "),routeMarkerEn:["tracking-tighter","text-[2.75cqw]","max-sm:text-[3cqw]"].join(" "),routeNumber:["basis-[17.5%]","font-[500]","text-[6.75cqw]","text-center","tracking-tight","scale-y-110"].join(" "),arrowContainer:["flex","basis-[10%]","max-xl:basis-[3.25rem]","max-sm:basis-[2rem]","justify-center"].join(" "),destContainer:["flex flex-col","mr-0.5"].join(" "),destZh:["font-[500]","whitespace-nowrap","text-[4.375cqw]","max-md:text-[4.375cqw]","max-sm:text-[5cqw]"].join(" "),destEn:["font-[500]","text-sm","whitespace-nowrap","text-[2.25cqw]","max-md-[2.25cqw]","max-sm:text-[2.5cqw]"].join(" ")},Zt=()=>{var n,o,a,s;const{routeDetail:e,lastStopIndex:r}=w(i=>i.routeSelection);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:k.routeMarkerContainer,children:[t.jsx("div",{className:k.routeMarkerZh,children:"路線"}),t.jsx("div",{className:k.routeMarkerEn,children:"Route"})]}),t.jsx("div",{className:k.routeNumber,children:e.route}),t.jsx("div",{className:k.arrowContainer,children:t.jsx(ar,{})}),t.jsxs("div",{className:k.destContainer,children:[t.jsx("div",{className:k.destZh,children:(o=(n=e==null?void 0:e.stops)==null?void 0:n[r])==null?void 0:o.zh}),t.jsx("div",{className:k.destEn,children:(s=(a=e==null?void 0:e.stops)==null?void 0:a[r])==null?void 0:s.en})]})]})},Gt=750,h={refContainer:"compact-progress-bar h-full",stopNameContainer:"stop-name-container @container w-full h-full relative",stopInfoRow:"stopInfoRow flex gap-1 w-full relative top-[33%] mb-[12cqw] items-center justify-center",stopInfoCol:"stopInfoCol flex flex-col gap-0.5 basis-[33%] min-w-[0] h-full justify-center",stopZh:"relative text-[2.5cqw] w-full text-center flex items-center justify-center",stopZhCurrent:"font-bold",stopEn:"relative text-[1.5cqw] w-full text-center flex items-center justify-center",stopEnCurrent:"font-black",stopEnOther:"text-black",progressBar:["progress-bar","line","flex justify-around","bg-[#FF0000]","w-[87.5%] h-[1.5cqw]","relative top-[-7cqw]","z-0"].join(" "),bullet:["bullet","bg-white","translate-x-[2cqw]","w-[1.5cqw] h-[1.5cqw]","max-sm:w-[1.75cqw] max-sm:h-[1.75cqw]","border-[1px] border-solid rounded-[50%]","relative","z-1","shrink-0"].join(" "),bulletPulse:["bulletPulse","outline outline-[0.15cqw] outline-white","border-[0.15cqw] border-[#FF0000]","!bg-[#FFFF00]","scale-125"].join(" "),bulletSecond:"bulletSecond translate-x-[7cqw]",bulletThird:"bulletThird translate-x-[11cqw]",arrowContainer:"absolute -translate-x-[37.5cqw]",arrowFirst:["absolute left-0","w-[1.5cqw] h-[1.5cqw]","border-t-[0.25vw] border-r-[0.25vw]","border-t-white border-r-white","rotate-45"].join(" "),arrowSecond:["absolute left-[1.75cqw]","w-[1.5cqw] h-[1.5cqw]","border-t-[0.25vw] border-r-[0.25vw]","border-t-white border-r-white","rotate-45"].join(" "),arrowThird:["absolute left-[3.5cqw]","w-[1.5cqw] h-[1.5cqw]","border-t-[0.25vw] border-r-[0.25vw]","border-t-white border-r-white","rotate-45"].join(" "),endIndicator:"h-[1.75cqw] border-1 border-solid border-red-600 rounded-[1px]",endIndicatorContainer:["absolute right-[-4%] top-1/2","-translate-y-1/2","flex gap-[1px]","z-10"].join(" ")},Dt=({progressBarRef:e})=>{const{routeDetail:r,currentStopIndex:n}=w(i=>i.routeSelection),[o,a]=p.useState(0),s=p.useRef(null);return p.useEffect(()=>(a(0),s.current&&clearInterval(s.current),s.current=setInterval(()=>{a(i=>i<3?i+1:0)},Gt),()=>clearInterval(s.current)),[n]),t.jsxs("div",{className:h.refContainer,ref:e,children:[t.jsx("div",{className:h.stopNameContainer,children:t.jsx("div",{className:h.stopInfoRow,children:[0,1,2].map(i=>{var d;const c=(d=r==null?void 0:r.stops)==null?void 0:d[n+i];return t.jsxs("div",{className:h.stopInfoCol,children:[t.jsx("div",{className:[h.stopZh,i===0&&h.stopZhCurrent].filter(Boolean).join(" "),children:c==null?void 0:c.zh}),t.jsx("div",{className:[h.stopEn,i===0?h.stopEnCurrent:h.stopEnOther].filter(Boolean).join(" "),children:c==null?void 0:c.en})]},i)})})}),t.jsxs("div",{className:h.progressBar,children:[t.jsxs("div",{className:h.arrowContainer,children:[o>=1&&t.jsx("div",{className:h.arrowFirst}),o>=2&&t.jsx("div",{className:h.arrowSecond}),o>=3&&t.jsx("div",{className:h.arrowThird})]}),[0,1,2].map(i=>t.jsx("div",{className:[h.bullet,i===0?h.bulletPulse:i===1?h.bulletSecond:h.bulletThird].filter(Boolean).join(" ")},i)),t.jsxs("div",{className:h.endIndicatorContainer,children:[t.jsx("div",{className:`${h.endIndicator} w-[0.25vw]`}),t.jsx("div",{className:`${h.endIndicator} w-[0.375vw]`}),t.jsx("div",{className:`${h.endIndicator} w-[0.5vw]`})]})]})]})},Kt=32,S={refContainer:"h-full",container:["line-container","@container flex","relative top-[87.5%]","w-[96.5%] h-[92%]","max-md:top-[89%]"].join(" "),startLineContainer:"flex gap-[2px] z-1",endLineContainer:["flex gap-[2px] justify-end","relative","w-full","max-md:gap-[0.5px]"].join(" "),progressBar:["@container line","flex flex-row justify-evenly","absolute left-1.5","w-[98%] h-[1.5cqw]","max-sm:w-[97%]","z-0"].join(" "),bullet:["bullet relative","bg-white border border-solid rounded-full","w-[1.5cqw] h-[1.5cqw]","z-1 shrink-0"].join(" "),bulletPulse:["animate-bullet-pulse","w-full h-full","rounded-[50%] bg-white"].join(" "),startLineBar:["bg-[gray]","w-[.2cqw] h-[2.5cqw]","max-md:w-[.375cqw] max-md:h-[3.5cqw]"].join(" "),endLineBar:["bg-[#FF0000]","w-[.2cqw] h-[2.5cqw]","max-md:w-[.375cqw] max-mx:h-[3.5cqw]"].join(" "),stopName:["stop-name absolute","text-black text-[1.75cqw]","top-[-2.75cqw] left-1/2","-translate-x-[5%] -rotate-[65deg]","origin-left whitespace-nowrap","max-md:text-[2cqw] max-md:top-[-3cqw]"].join(" "),stopNameCurrent:["font-black"].join(" "),stopNamePast:["!text-gray-300"].join(" "),splitEllipsis:["absolute text-xl","top-[-7cqw] right-[-3cqw]"].join(" ")},Ut=({stop:e,i:r,currentStopIndex:n})=>{const o=r===n,a=r<n;return t.jsxs("div",{className:S.bullet,style:{position:"relative"},children:[o&&t.jsx("div",{className:S.bulletPulse}),t.jsx("div",{className:[S.stopName,o&&S.stopNameCurrent,a&&S.stopNamePast].filter(Boolean).join(" "),children:e.zh})]})},Vt=({progressBarRef:e})=>{var j,y;const{routeDetail:r,currentStopIndex:n,isUserSelectedRoute:o}=w(l=>l.routeSelection),a=((j=r==null?void 0:r.stops)==null?void 0:j.length)??0,s=Kt,i=Math.floor(s*.8),[c,d]=Rt(a,n,s,i),u=d-c,x=n-c,m=u>1?x/(u+1)*100:0,b=a>s&&d<a;return t.jsx("div",{className:S.refContainer,ref:e,children:t.jsxs("div",{className:S.container,children:[o&&c===0&&t.jsx("div",{className:S.startLineContainer,children:[...Array(2)].map((l,g)=>t.jsx("div",{className:S.startLineBar},g))}),t.jsxs("div",{style:{background:`linear-gradient(to right, gray 0%, gray ${m}%, red ${m}%)`},className:S.progressBar,children:[(y=r==null?void 0:r.stops)==null?void 0:y.slice(c,d).map((l,g)=>t.jsx(Ut,{stop:l,i:c+g,currentStopIndex:n},c+g)),b&&t.jsx("div",{className:S.splitEllipsis,children:"..."})]}),o&&d===a&&t.jsx("div",{className:S.endLineContainer,children:[...Array(2)].map((l,g)=>t.jsx("div",{className:S.endLineBar},g))})]})})},O={parentGrid:["select-none","grid","grid-cols-[10fr_90fr]","grid-rows-[3.25fr_0.025fr_2fr_0.025fr_2fr]"].join(" "),arrowContainer:"@container text-center bg-[#FF0000]",arrowIcon:"mt-[0.5rem] justify-center",currentStopContainer:"flex flex-col bg-white"},Jt=({monitorStyle:e,screenTarget:r})=>{var d,u;const{routeDetail:n,currentStopIndex:o}=w(x=>x.routeSelection),{showMindDoorNotice:a,showHandrailNotice:s}=w(x=>x.userPreference),i=n==null?void 0:n.stops,c=[1,2].map(x=>{var m,b;return t.jsx(Qt,{stopZh:(m=i==null?void 0:i[o+x])==null?void 0:m.zh,stopEn:(b=i==null?void 0:i[o+x])==null?void 0:b.en},x)});return t.jsxs("div",{ref:r,className:`${O.parentGrid} ${e}`,children:[a?t.jsx(Fe,{}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:O.arrowContainer,children:t.jsx("div",{className:O.arrowIcon,children:t.jsx(Xt,{})})}),t.jsx("div",{className:O.currentStopContainer,children:t.jsx(Yt,{stopZh:(d=i==null?void 0:i[o])==null?void 0:d.zh,stopEn:(u=i==null?void 0:i[o])==null?void 0:u.en})})]}),s?t.jsx(Ie,{}):t.jsx(t.Fragment,{children:c})]})},Xt=e=>t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",shapeRendering:"geometricPrecision",textRendering:"geometricPrecision",viewBox:"0 0 160 300",...e,children:[t.jsxs("g",{fill:"#3f5787",stroke:"#fbfbfb",strokeWidth:3,children:[t.jsx("path",{d:"M-96 0H4",transform:"matrix(.64952 .375 -3.75 6.4952 82.563 45.202)"}),t.jsx("path",{d:"M-96 0H4",transform:"matrix(.64952 -.375 3.75 6.4952 136.34 10.702)"}),t.jsx("path",{d:"M-96 0H4",transform:"matrix(.64952 .375 -3.75 6.4952 82.563 91.702)"}),t.jsx("path",{d:"M-96 0H4",transform:"matrix(.64952 -.375 3.75 6.4952 136.34 57.202)"}),t.jsx("path",{d:"M-96 0H4",transform:"matrix(.64952 .375 -3.75 6.4952 82.563 138.202)"}),t.jsx("path",{d:"M-96 0H4",transform:"matrix(.64952 -.375 3.75 6.4952 136.34 103.702)"})]}),t.jsxs("g",{transform:"matrix(.75 0 0 .75 -16.586 -9.692)",children:[t.jsx("ellipse",{fill:"#fff",rx:66.997,ry:67.383,transform:"matrix(1.32296 0 0 1.29333 128.995 324.173)"}),t.jsx("ellipse",{fill:"#fffa00",stroke:"red",strokeWidth:10,rx:66.997,ry:67.383,transform:"matrix(.94385 0 0 .93055 128.995 322.985)"})]})]}),L={container:["@container","font-[500]","relative left-[1.25%]","w-[95%] h-[75%]","tracking-[-0.0625rem]"].join(" "),zhStopName:["h-[12cqw]","relative top-[2cqw]","flex items-center"].join(" "),enStopNameWrapper:["absolute","top-[80%]","whitespace-nowrap"].join(" "),enStopName:["text-[4.75cqw]","max-md:text-[5cqw]"].join(" ")},se=(e="",r="en",n)=>{if(!e)return{};if(r==="en"){const o=n<640?1.8:n<768?1.625:1.75,a=e.length;return a>=34?a>=44?{fontSize:`${o*2.125}cqw`}:{fontSize:`${o*2.5}cqw`}:{}}if(r==="zh"){const o=V(e);return{fontSize:`clamp(7cqw, ${Math.max(20-o*.7,7.25)}cqw, 11cqw)`}}return{}},Yt=({stopZh:e="",stopEn:r=""})=>{const{windowSize:n}=I();return t.jsxs("div",{className:L.container,children:[t.jsx("div",{className:L.zhStopName,style:se(e,"zh"),children:e}),t.jsx("div",{className:L.enStopNameWrapper,children:t.jsx("span",{className:L.enStopName,style:se(r,"en",n),children:r})})]})},q={divider:["col-start-1","col-end-5","bg-[#f7f6f6c5]"].join(" "),stopIndicatorContainer:["@container","flex flex-col justify-center items-center","bg-[#FF0000]"].join(" "),stopIndicator:["inline-block","rounded-[50%]","bg-white","w-[65cqw] h-[65cqw]"].join(" "),stopNameContainer:["@container","relative","flex flex-col","bg-white","tracking-[-0.0375rem]"].join(" "),stopNameContent:["@container","font-[500]","relative left-[1.25%]","flex flex-col","h-[90%]","whitespace-nowrap"].join(" "),zhStopName:["relative","justify-center","max-md:top-[0.25cqw]"].join(" "),enStopName:["justify-center","absolute top-[72.5%]","text-[3.5cqw]","max-sm:text-[3.75cqw]","sm:max-md:text-[3.75cqw]","md:max-xl:text-[3.5cqw]"].join(" ")},ae=(e,r,n)=>{if(r==="zh"){const o=V(e||"");return{fontSize:`clamp(6.8cqw, ${Math.max(18-o*.5,7)}cqw, 8cqw)`,marginTop:`${o>=14?o*.01:0}cqh`}}else if(r==="en"){const o=n<768?4:n<1280?3.75:3.5,a=(e==null?void 0:e.length)??0;return a>=45?{fontSize:`${o*(a>=50?.8:.85)}cqw`}:{}}return{}},Qt=({stopZh:e="",stopEn:r=""})=>{const{windowSize:n}=I();return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:q.divider}),t.jsx("div",{className:q.stopIndicatorContainer,children:t.jsx("div",{className:q.stopIndicator})}),t.jsx("div",{className:q.stopNameContainer,children:t.jsxs("div",{className:q.stopNameContent,children:[t.jsx("div",{className:q.zhStopName,style:ae(e,"zh"),children:e}),t.jsx("span",{className:q.enStopName,style:ae(r,"en",n),children:r})]})})]})},Ie=({containerOverrideStyle:e="",zhNameOverrideStyle:r="",enNameOverrideStyle:n=""})=>{const o={noticeContainer:"@container w-full h-full row-span-99 col-span-2 flex flex-col items-center justify-center bg-amber-300",textZh:"text-[12cqw] mt-[-1cqw] tracking-wider font-[700]",textEn:"text-[5.5cqw] mt-[-1.5cqw] tracking-tight font-[700]"};return t.jsxs("div",{className:o.noticeContainer+" "+e,children:[t.jsx("div",{className:o.textZh+" "+r,children:"請緊握扶手"}),t.jsx("div",{className:o.textEn+" "+n,children:"Please hold the handrail"})]})},Fe=({containerOverrideStyle:e="",zhNameOverrideStyle:r="",enNameOverrideStyle:n=""})=>{const o={noticeContainer:"@container w-full h-full flex flex-col gap-1 col-span-3 justify-center items-center text-center bg-[#FF0000]",textZh:"text-[10cqw] mt-[-1cqw] text-white font-[600]",textEn:"text-[5cqw] mt-[-1.5cqw] text-white font-[600]"};return t.jsxs("div",{className:o.noticeContainer+" "+e,children:[t.jsx("div",{className:o.textZh+" "+r,children:"車門正在關上"}),t.jsx("div",{className:o.textEn+" "+n,children:"Door Closing"})]})},er=()=>t.jsx("div",{className:"fixed inset-0 -z-10 bg-gradient-to-br from-[#32302c] via-[#32323f] to-[#212525]",children:t.jsx("svg",{width:"100%",height:"100%",className:"absolute inset-0 pointer-events-none",style:{minHeight:"100vh"}})});f.string,f.string.isRequired,f.bool,f.func.isRequired;const tr=({error:e})=>t.jsx("div",{className:"flex items-center justify-center p-4 w-full",children:t.jsxs("div",{className:"flex items-center gap-4 bg-red-50 border-l-12 border-red-500 p-4 rounded-r shadow-lg max-w-2xl",children:[t.jsx(Ge,{className:"text-red-500 text-3xl"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-red-600",children:e||"An unexpected error occurred. Please try again."}),t.jsx("button",{onClick:()=>window.location.reload(),className:"mt-3 text-sm text-red-700 hover:cursor-pointer hover:text-red-900 underline",children:"Refresh Page"})]})]})}),rr=de(pe)(({theme:e})=>({width:"100%",padding:e.spacing(2)})),nr=de(W)(({theme:e})=>({fontSize:"0.75rem",color:"rgba(255,255,255, 0.5)",textAlign:"center",[e.breakpoints.down("sm")]:{fontSize:"0.75rem"}})),or=()=>t.jsx(rr,{component:"footer",children:t.jsx(De,{maxWidth:"xl",children:t.jsx("div",{className:"max-md:hidden flex items-center justify-center",children:t.jsx(nr,{variant:"body2",component:"div",children:t.jsx("a",{target:"_blank",rel:"noreferrer",className:"text-gray-400/80 underline",href:"https://github.com/silverfankw/kmb-dpip",children:"silverfankw/kmb-dpip-v2 @ 2025"})})})})}),qe=({message:e="",style:r={},tailwindStyle:n=""})=>t.jsx("span",{style:r,className:`text-xs ${n}`,children:e});qe.propTypes={message:f.string.isRequired,style:f.object,tailwindStyle:f.string};const _=({id:e,type:r="text",pattern:n,validInput:o=!0,invalidMessage:a="",value:s="",style:i="",placeholder:c="",minLength:d,maxLength:u,onChange:x,onInput:m})=>t.jsxs("div",{children:[c&&t.jsx("label",{htmlFor:e,className:"text-xs text-gray-200",children:c}),t.jsx("input",{id:e,type:r,value:s,pattern:n,minLength:d,maxLength:u,className:`block bg-white text-black text-xs w-full 
                    rounded-lg border border-gray-500 py-3 pl-3 pr-10 
                    placeholder:text-gray-400 placeholder:text-xs
                    ${i}`,onChange:b=>x==null?void 0:x(b.target.value),onInput:m}),a&&!o&&s.length>0&&t.jsx(qe,{message:a,tailwindStyle:"text-red-600"})]});_.propTypes={id:f.string,type:f.string,pattern:f.string,validInput:f.bool,invalidMessage:f.string,value:f.string,style:f.string,placeholder:f.string,minLength:f.number,maxLength:f.number,onChange:f.func,onInput:f.func,submitAction:f.func};const sr=()=>t.jsx(pe,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:t.jsx(Ke,{color:"primary"})}),K=({sx:e,control:r,label:n})=>t.jsx(Ue,{sx:e,control:r,label:n}),ar=e=>t.jsx("svg",{width:"100%",height:"100%",style:{display:"block",maxWidth:"200px",height:"auto"},xmlns:"http://www.w3.org/2000/svg",shapeRendering:"geometricPrecision",textRendering:"geometricPrecision",viewBox:"0 0 200 130",...e,children:t.jsxs("g",{fill:"#fff",children:[t.jsxs("g",{transform:"translate(-714.021 -20.258)",children:[t.jsx("rect",{width:100.287,height:40.115,rx:0,ry:0,transform:"matrix(.48535 -.48535 .62202 0 727.59 131.579)"}),t.jsx("rect",{width:100.287,height:40.115,rx:0,ry:0,transform:"matrix(.49848 .49848 -.62202 0 751.225 32.957)"})]}),t.jsxs("g",{transform:"translate(-664.073 -19.578)",children:[t.jsx("rect",{width:100.287,height:40.115,rx:0,ry:0,transform:"matrix(.48535 -.48535 .62202 0 727.59 131.579)"}),t.jsx("rect",{width:100.287,height:40.115,rx:0,ry:0,transform:"matrix(.49848 .49848 -.62202 0 751.225 32.957)"})]}),t.jsxs("g",{transform:"translate(-613.467 -18.898)",children:[t.jsx("rect",{width:100.287,height:40.115,rx:0,ry:0,transform:"matrix(.48535 -.48535 .62202 0 727.59 131.579)"}),t.jsx("rect",{width:100.287,height:40.115,rx:0,ry:0,transform:"matrix(.49848 .49848 -.62202 0 751.225 32.957)"})]})]})}),C={rootContainer:"min-h-screen flex flex-col items-center",contentContainer:["select-none focus:outline-hidden","p-[2rem] max-sm:p-2","flex flex-1 flex-col gap-3 ","max-sm:gap-2"].join(" "),querySection:["order-1 max-sm:order-2","flex gap-3 items-center justify-center","bg-[#18181b]/80 backdrop-blur-md shadow-2xl ","p-6 max-md:p-4 max-md:flex-col max-md:gap-2","border border-gray-600/90 rounded-2xl"].join(" "),controlPanelSection:["order-2 max-sm:order-3","flex gap-3 flex-wrap justify-center","bg-[#18181b]/80 shadow-lg","p-6 w-full max-md:flex-col max-md:gap-4","border border-gray-600/90 rounded-2xl"].join(" "),screenPanelSection:["order-3 max-sm:order-1","flex flex-wrap items-center justify-center","gap-10 max-sm:gap-6 py-4"].join(" "),asyncSelectWrapper:"flex items-center gap-4 w-full",monitorStyle:["w-[800px] h-[480px]","max-xl:w-[700px] max-xl:h-[420px]","max-md:w-[600px] max-md:h-[360px]","max-sm:w-[400px] max-sm:h-[240px]","shadow-[0.5rem_0.5rem_1rem_0.25rem_#23272f]","border-[.375rem] max-md:border-[.25em] border-solid border-[#23272f]","rounded-xl","outline outline-[0.875rem] max-sm:outline-[0.625rem] outline-[#000000]","z-1"].join(" ")},ir=()=>{const e=le(),r=B();p.useEffect(()=>{r(dt())},[r]);const{isUserSelectedRoute:n,loadingError:o}=w(i=>i.routeSelection),a=p.useRef(null),s=p.useRef(null);return qt({onPrev:()=>r(je()),onNext:()=>r(ye()),onHome:()=>r(be(0)),onEnd:()=>r(ge()),isUserSelectedRoute:n,debounceMs:100,isDisabled:!1}),t.jsxs(t.Fragment,{children:[t.jsx(er,{}),t.jsxs("div",{className:C.rootContainer,children:[t.jsxs("div",{className:C.contentContainer,tabIndex:1,children:[t.jsx("section",{className:C.querySection,children:t.jsxs("div",{className:C.asyncSelectWrapper,children:[t.jsx(Ve,{sx:{color:"#999",fontSize:24,[e.breakpoints.down("sm")]:{display:"none"}}}),t.jsx("div",{className:"flex-1",children:t.jsx($t,{})})]})}),t.jsx("section",{className:C.controlPanelSection,children:t.jsx(It,{mainScreenTarget:a,secScreenTarget:s})}),t.jsx("section",{className:C.screenPanelSection,children:o?t.jsx(tr,{error:o}):t.jsxs(t.Fragment,{children:[t.jsx(Ht,{monitorStyle:C.monitorStyle,screenTarget:a}),t.jsx(Jt,{monitorStyle:C.monitorStyle,screenTarget:s})]})})]}),t.jsx(or,{})]})]})};Re.createRoot(document.getElementById("root")).render(t.jsx(Me,{store:kt,children:t.jsx(Ee,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:t.jsx(Je,{theme:Ct,children:t.jsx(ir,{})})})}));
